<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ†Ô∏è DirectOS v7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* UI Utilities */
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .flow-line { background: linear-gradient(90deg, #334155 0%, #3b82f6 50%, #334155 100%); background-size: 200% 100%; animation: flowAnimation 2s infinite linear; }
        @keyframes flowAnimation { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        .tool-checkbox:checked + div { border-color: #3b82f6; background-color: rgba(59, 130, 246, 0.1); }
        .tool-checkbox:checked + div .check-icon { opacity: 1; }

        /* ARQUITECTO VISUAL STYLES */
        .draggable-tool { cursor: grab; user-select: none; transition: all 0.2s; }
        .draggable-tool:active { cursor: grabbing; transform: scale(0.98); }
        
        /* Colores de Categor√≠a */
        .cat-frontend { border-left-color: #f97316; } 
        .cat-backend { border-left-color: #22c55e; }  
        .cat-ai { border-left-color: #a855f7; }       
        .cat-storage { border-left-color: #eab308; }  
        .cat-process { border-left-color: #ec4899; }  

        .flow-arrow::after { content: '‚¨á'; display: block; text-align: center; color: #64748b; font-size: 1.2rem; margin: 0.5rem 0; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-5px);} 60% {transform: translateY(-3px);} }
        .flow-node:last-child .flow-arrow::after { display: none; }

        .interactive-node { cursor: pointer; transition: all 0.3s ease; }
        .interactive-node:hover { transform: scale(1.03); box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); border-color: #60a5fa; }

        /* MONITOR STYLES */
        .terminal-line { font-family: 'Courier New', monospace; animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; }
        .status-online { background-color: #22c55e; box-shadow: 0 0 10px #22c55e; }
        .status-offline { background-color: #ef4444; box-shadow: 0 0 10px #ef4444; }

        /* ESTADOS DE MAESTR√çA */
        .status-badge { font-size: 10px; font-weight: 600; padding: 2px 8px; border-radius: 9999px; text-transform: uppercase; letter-spacing: 0.05em; }
        .status-used { background-color: rgba(34, 197, 94, 0.2); color: #22c55e; border: 1px solid rgba(34, 197, 94, 0.3); }
        .status-learning { background-color: rgba(234, 179, 8, 0.2); color: #eab308; border: 1px solid rgba(234, 179, 8, 0.3); }
        .status-new { background-color: rgba(59, 130, 246, 0.2); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }

        /* Categor√≠a DevOps */
        .cat-devops { border-left-color: #f97316; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 h-screen flex overflow-hidden selection:bg-blue-500 selection:text-white">

    <!-- SIDEBAR -->
    <aside class="w-64 bg-slate-900 border-r border-slate-800 flex-shrink-0 flex flex-col transition-all duration-300">
        <div class="p-6 border-b border-slate-800">
            <h1 class="text-xl font-bold text-white tracking-tight flex items-center gap-2">
                <i class="fa-solid fa-layer-group text-blue-500"></i>
                Director<span class="text-slate-500">OS</span>
            </h1>
            <p class="text-xs text-slate-500 mt-1">v7.0 - Knowledge Base</p>
        </div>
        
        <nav class="flex-1 overflow-y-auto p-4 space-y-2">
            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2 pl-2">Dise√±o</p>
            <button onclick="switchView('architect')" id="btn-architect" class="w-full text-left px-3 py-2.5 rounded-lg text-sm transition font-medium flex items-center gap-3 bg-blue-600 text-white shadow-lg shadow-blue-900/20"><i class="fa-solid fa-pen-ruler"></i> Arquitecto Pro</button>
            <button onclick="switchView('flow')" id="btn-flow" class="w-full text-left px-3 py-2.5 rounded-lg hover:bg-slate-800 text-slate-400 text-sm transition font-medium flex items-center gap-3"><i class="fa-solid fa-diagram-project"></i> Flujos T√°cticos</button>
            <button onclick="switchView('generator')" id="btn-generator" class="w-full text-left px-3 py-2.5 rounded-lg hover:bg-slate-800 text-slate-400 text-sm transition font-medium flex items-center gap-3"><i class="fa-solid fa-wand-magic-sparkles"></i> Generador Prompts</button>
            
            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2 pl-2 mt-6">Operaciones</p>
            <button onclick="switchView('monitor')" id="btn-monitor" class="w-full text-left px-3 py-2.5 rounded-lg hover:bg-slate-800 text-slate-400 text-sm transition font-medium flex items-center gap-3"><i class="fa-solid fa-heart-pulse"></i> Monitor Sistema</button>
            <button onclick="switchView('grid')" id="btn-grid" class="w-full text-left px-3 py-2.5 rounded-lg hover:bg-slate-800 text-slate-400 text-sm transition font-medium flex items-center gap-3"><i class="fa-solid fa-boxes-stacked"></i> Glosario</button>
        </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col min-w-0 relative bg-slate-950">
        
        <!-- Header -->
        <header class="bg-slate-900/50 backdrop-blur border-b border-slate-800 p-4 h-16 flex justify-between items-center sticky top-0 z-20">
            <div class="flex items-center gap-4">
                <h2 id="page-title" class="text-lg font-semibold text-white">Arquitecto Pro</h2>
                <!-- Dynamic Header Content -->
                <div id="header-tools" class="hidden flex gap-2">
                    <button onclick="saveArchitecture()" class="bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1.5 rounded border border-slate-700 transition flex items-center gap-2" title="Guardar"><i class="fa-solid fa-floppy-disk"></i> Guardar</button>
                    <button onclick="loadArchitectureModal()" class="bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1.5 rounded border border-slate-700 transition flex items-center gap-2" title="Cargar"><i class="fa-solid fa-folder-open"></i> Cargar</button>
                    <button onclick="exportDiagram()" class="bg-slate-800 hover:bg-slate-700 text-xs px-3 py-1.5 rounded border border-slate-700 transition flex items-center gap-2" title="Exportar"><i class="fa-solid fa-camera"></i> PNG</button>
                </div>
            </div>
            <div class="flex gap-3 items-center">
                <span class="text-xs font-mono text-slate-500 bg-slate-900 px-2 py-1 rounded border border-slate-800" id="clock">00:00</span>
            </div>
        </header>

        <!-- VISTA 0: ARQUITECTO VISUAL PRO -->
        <div id="view-architect" class="flex-1 overflow-hidden flex relative">
            <div class="w-64 bg-slate-900 border-r border-slate-800 p-4 overflow-y-auto flex-shrink-0">
                <!-- Selector de Presets -->
                <div class="mb-6">
                    <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-3">Patrones</h3>
                    <select id="preset-selector" onchange="loadPreset(this.value)" class="w-full bg-slate-950 border border-slate-700 rounded-lg p-2 text-sm text-slate-300 mb-2">
                        <option value="">-- Seleccionar patr√≥n --</option>
                    </select>
                    <div id="preset-info" class="hidden bg-slate-950/50 border border-slate-800 rounded-lg p-3 text-xs">
                        <p id="preset-desc" class="text-slate-400 mb-2"></p>
                        <p id="preset-flow" class="text-blue-400 font-mono text-[10px]"></p>
                        <p id="preset-usecase" class="text-slate-500 mt-2 italic"></p>
                    </div>
                </div>
                <div class="border-t border-slate-800 pt-4">
                    <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Herramientas</h3>
                    <div id="architect-toolbox" class="space-y-3"></div>
                </div>
            </div>
            <div class="flex-1 bg-slate-950 p-8 overflow-y-auto relative bg-[radial-gradient(#1e293b_1px,transparent_1px)] [background-size:16px_16px]">
                <div class="max-w-2xl mx-auto relative">
                    <!-- Barra de Herramientas Flotante -->
                    <div class="flex justify-between items-center mb-6 bg-slate-900/80 backdrop-blur p-2 rounded-lg border border-slate-800">
                        <div class="flex gap-4 text-[10px] uppercase font-bold tracking-wider text-slate-500 px-2">
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-orange-500"></span> Front</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-500"></span> Back</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-purple-500"></span> IA</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-yellow-500"></span> DB</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="validateFlow()" class="text-xs px-3 py-1 rounded hover:bg-slate-700 text-slate-300 transition flex items-center gap-1"><i class="fa-solid fa-check-circle text-green-500"></i> Validar</button>
                            <button onclick="estimateComplexity()" class="text-xs px-3 py-1 rounded hover:bg-slate-700 text-slate-300 transition flex items-center gap-1"><i class="fa-solid fa-chart-line text-blue-500"></i> Estimar</button>
                        </div>
                    </div>

                    <!-- Canvas -->
                    <div id="architect-canvas" class="min-h-[500px] pb-32 space-y-2 p-4 bg-slate-950 rounded-xl"></div>
                    
                    <!-- Bot√≥n Compilar -->
                    <div class="fixed bottom-8 right-8 left-72 max-w-2xl mx-auto z-30">
                        <div class="bg-slate-900/90 backdrop-blur border border-slate-700 p-4 rounded-xl shadow-2xl flex gap-4 items-center justify-between">
                            <div class="text-xs text-slate-400"><span id="node-count" class="font-bold text-white">0</span> nodos conectados</div>
                            <button onclick="compileArchitecture()" class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 text-white font-bold py-2 px-6 rounded-lg shadow-lg flex items-center gap-2 transition transform active:scale-95"><i class="fa-solid fa-code"></i> Compilar a C√≥digo</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modales -->
        <div id="architect-output-modal" class="hidden absolute inset-0 bg-slate-950/90 z-50 flex items-center justify-center p-8 backdrop-blur-sm">
            <div class="bg-slate-900 border border-slate-700 rounded-xl w-full max-w-3xl shadow-2xl flex flex-col max-h-full">
                <div class="p-4 border-b border-slate-800 flex justify-between items-center"><h3 class="font-bold text-white">Resultado</h3><button onclick="closeModal('architect-output-modal')" class="text-slate-500 hover:text-white"><i class="fa-solid fa-times"></i></button></div>
                <div class="p-6 overflow-y-auto flex-1 bg-slate-950"><pre id="architect-prompt-output" class="font-mono text-xs text-slate-300 whitespace-pre-wrap leading-relaxed"></pre></div>
                <div class="p-4 border-t border-slate-800 bg-slate-900 flex justify-end"><button onclick="copyArchitectPrompt()" class="bg-blue-600 hover:bg-blue-500 text-white text-xs px-4 py-2 rounded-lg font-medium transition">Copiar</button></div>
            </div>
        </div>

        <div id="load-modal" class="hidden absolute inset-0 bg-slate-950/90 z-50 flex items-center justify-center p-8 backdrop-blur-sm">
            <div class="bg-slate-900 border border-slate-700 rounded-xl w-96 shadow-2xl">
                <div class="p-4 border-b border-slate-800 flex justify-between items-center"><h3 class="font-bold text-white">Cargar Arquitectura</h3><button onclick="closeModal('load-modal')" class="text-slate-500 hover:text-white"><i class="fa-solid fa-times"></i></button></div>
                <div id="load-list" class="p-2 max-h-64 overflow-y-auto space-y-1"></div>
            </div>
        </div>

        <!-- Modal Patr√≥n Detalle -->
        <div id="pattern-modal" class="hidden absolute inset-0 bg-slate-950/90 z-50 flex items-center justify-center p-8 backdrop-blur-sm">
            <div class="bg-slate-900 border border-slate-700 rounded-xl w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh]">
                <div class="p-4 border-b border-slate-800 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <span id="pattern-modal-emoji" class="text-2xl"></span>
                        <h3 id="pattern-modal-title" class="font-bold text-white text-lg"></h3>
                    </div>
                    <button onclick="closeModal('pattern-modal')" class="text-slate-500 hover:text-white"><i class="fa-solid fa-times"></i></button>
                </div>
                <div class="p-6 overflow-y-auto flex-1 space-y-5">
                    <!-- Problema -->
                    <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-4">
                        <h4 class="text-xs font-bold text-red-400 uppercase tracking-widest mb-2 flex items-center gap-2"><i class="fa-solid fa-triangle-exclamation"></i> Problema</h4>
                        <p id="pattern-modal-problem" class="text-sm text-slate-300"></p>
                    </div>
                    <!-- Prompt -->
                    <div class="bg-slate-950 border border-slate-800 rounded-lg p-4">
                        <h4 class="text-xs font-bold text-blue-400 uppercase tracking-widest mb-2 flex items-center gap-2"><i class="fa-solid fa-wand-magic-sparkles"></i> Prompt</h4>
                        <pre id="pattern-modal-prompt" class="text-sm text-slate-300 whitespace-pre-wrap font-mono leading-relaxed"></pre>
                    </div>
                    <!-- Flujo T√°ctico -->
                    <div class="bg-purple-500/10 border border-purple-500/30 rounded-lg p-4">
                        <h4 class="text-xs font-bold text-purple-400 uppercase tracking-widest mb-3 flex items-center gap-2"><i class="fa-solid fa-diagram-project"></i> Flujo T√°ctico</h4>
                        <p id="pattern-modal-flowdesc" class="text-xs text-slate-400 mb-3 font-mono"></p>
                        <div id="pattern-modal-flow" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
                <div class="p-4 border-t border-slate-800 bg-slate-900 flex gap-3">
                    <button onclick="loadPatternToPrompt()" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white text-sm px-4 py-2 rounded-lg font-medium transition flex items-center justify-center gap-2">
                        <i class="fa-solid fa-copy"></i> Usar Prompt
                    </button>
                    <button onclick="loadPatternToArchitect()" class="flex-1 bg-purple-600 hover:bg-purple-500 text-white text-sm px-4 py-2 rounded-lg font-medium transition flex items-center justify-center gap-2">
                        <i class="fa-solid fa-pen-ruler"></i> Abrir en Arquitecto
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal Ficha T√©cnica (Tool Detail) -->
        <div id="tool-modal" class="hidden absolute inset-0 bg-slate-950/90 z-50 flex items-center justify-center p-8 backdrop-blur-sm">
            <div class="bg-slate-900 border border-slate-700 rounded-xl w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh]">
                <div class="p-4 border-b border-slate-800 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <i id="tool-modal-icon" class="fa-solid text-2xl"></i>
                        <div>
                            <h3 id="tool-modal-title" class="font-bold text-white text-lg"></h3>
                            <span id="tool-modal-tag" class="text-xs text-slate-500"></span>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span id="tool-modal-status" class="status-badge"></span>
                        <button onclick="closeModal('tool-modal')" class="text-slate-500 hover:text-white"><i class="fa-solid fa-times"></i></button>
                    </div>
                </div>
                <div class="p-6 overflow-y-auto flex-1 space-y-5">
                    <!-- Qu√© es -->
                    <div>
                        <h4 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 flex items-center gap-2"><i class="fa-solid fa-circle-info text-blue-400"></i> Qu√© es</h4>
                        <p id="tool-modal-desc" class="text-sm text-slate-300 leading-relaxed"></p>
                    </div>
                    <!-- Por qu√© me importa -->
                    <div class="bg-purple-500/10 border border-purple-500/30 rounded-lg p-4">
                        <h4 class="text-xs font-bold text-purple-400 uppercase tracking-widest mb-2 flex items-center gap-2"><i class="fa-solid fa-lightbulb"></i> Por qu√© me importa</h4>
                        <p id="tool-modal-why" class="text-sm text-slate-300 leading-relaxed"></p>
                    </div>
                    <!-- Casos de Uso -->
                    <div>
                        <h4 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 flex items-center gap-2"><i class="fa-solid fa-folder-open text-amber-400"></i> Casos de uso en minerOS</h4>
                        <div id="tool-modal-cases" class="flex flex-wrap gap-2"></div>
                    </div>
                    <!-- C√≥digo -->
                    <div class="bg-slate-950 border border-slate-800 rounded-lg p-4">
                        <h4 class="text-xs font-bold text-green-400 uppercase tracking-widest mb-2 flex items-center gap-2"><i class="fa-solid fa-code"></i> Snippet de c√≥digo</h4>
                        <pre id="tool-modal-code" class="text-xs text-green-400 font-mono whitespace-pre-wrap overflow-x-auto"></pre>
                    </div>
                </div>
                <div class="p-4 border-t border-slate-800 bg-slate-900 flex gap-3">
                    <button onclick="addToolToArchitect()" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white text-sm px-4 py-2 rounded-lg font-medium transition flex items-center justify-center gap-2">
                        <i class="fa-solid fa-plus"></i> A√±adir al Arquitecto
                    </button>
                    <button onclick="copyToolCode()" class="bg-slate-700 hover:bg-slate-600 text-white text-sm px-4 py-2 rounded-lg font-medium transition flex items-center justify-center gap-2">
                        <i class="fa-solid fa-copy"></i> Copiar c√≥digo
                    </button>
                </div>
            </div>
        </div>

        <!-- VISTA 1: MONITOR -->
        <div id="view-monitor" class="hidden flex-1 overflow-y-auto p-8 bg-slate-950 relative">
            <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1 space-y-6">
                    <!-- Health Check -->
                    <div class="bg-slate-900 border border-slate-800 rounded-xl p-6 relative overflow-hidden group">
                        <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition"><i class="fa-solid fa-heart-pulse text-6xl text-blue-500"></i></div>
                        <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4">Salud Backend</h3>
                        <div class="flex items-end gap-3 mb-2"><span id="health-metric" class="text-4xl font-bold text-white">--</span><span class="text-sm text-slate-500 mb-1">ms</span></div>
                        <p id="health-msg" class="text-xs text-slate-500">Conectando...</p>
                        <div class="mt-4 h-1 w-full bg-slate-800 rounded-full overflow-hidden"><div id="health-bar" class="h-full bg-blue-500 w-0 transition-all duration-500"></div></div>
                    </div>
                    <!-- Scout Panel -->
                    <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
                        <div class="flex items-center gap-2 mb-4">
                            <i class="fa-solid fa-robot text-purple-400"></i>
                            <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest">Scout</h3>
                            <span class="text-[10px] bg-purple-500/20 text-purple-400 px-2 py-0.5 rounded-full">IA</span>
                        </div>
                        <p class="text-xs text-slate-500 mb-3">Pega un error y Scout te sugerir√° la soluci√≥n</p>
                        <textarea id="scout-input" rows="4" class="w-full bg-slate-950 border border-slate-700 rounded-lg p-3 text-xs font-mono text-slate-300 placeholder-slate-600" placeholder="TypeError: 'NoneType' object..."></textarea>
                        <button onclick="analyzeWithScout()" id="scout-btn" class="mt-3 w-full bg-purple-600 hover:bg-purple-500 text-white text-xs font-bold py-2 rounded-lg transition flex items-center justify-center gap-2">
                            <i class="fa-solid fa-magnifying-glass-chart"></i> Analizar Error
                        </button>
                    </div>
                </div>
                <div class="lg:col-span-2 flex flex-col h-[600px]">
                    <div class="bg-slate-950 border border-slate-800 rounded-t-xl p-3 flex justify-between items-center bg-slate-900/50">
                        <div class="flex gap-2"><div id="term-dot" class="w-3 h-3 rounded-full bg-red-500/20"></div><div class="w-3 h-3 rounded-full bg-yellow-500/20"></div><div class="w-3 h-3 rounded-full bg-green-500/20"></div></div><span class="text-xs font-mono text-slate-500">directos.log</span>
                    </div>
                    <div id="terminal-window" class="flex-1 bg-black/80 border-x border-b border-slate-800 rounded-b-xl p-4 font-mono text-xs overflow-y-auto space-y-1 shadow-inner"></div>
                </div>
            </div>
        </div>

        <!-- VISTA 2: FLUJO T√ÅCTICO -->
        <div id="view-flow" class="hidden flex-1 overflow-y-auto p-8 bg-slate-950 relative">
             <div class="max-w-5xl mx-auto">
                <div class="text-center mb-10"><h2 class="text-2xl font-bold text-white mb-2">Ingesta Inteligente</h2><p class="text-slate-400">Haz clic en los nodos para ver detalles y acciones.</p></div>
                <div class="relative flex flex-col items-center space-y-8">
                    <!-- Nivel 1 -->
                    <div class="relative group z-10" onclick="openNodeDetails('fastapi')">
                        <div class="interactive-node bg-slate-800 border border-slate-600 p-4 rounded-xl shadow-lg w-64 text-center border-l-4 border-l-green-500">
                            <span class="text-xs font-mono text-green-400 mb-1 block">üåê BACKEND</span>
                            <h3 class="text-lg font-bold text-white">FastAPI</h3>
                        </div>
                    </div>
                    
                    <div class="w-1 h-8 bg-slate-700"></div>
                    <div class="bg-slate-800 border border-slate-600 px-4 py-2 rounded-full text-xs text-slate-300">Router</div>
                    
                    <!-- Nivel 2 -->
                    <div class="w-full max-w-2xl flex justify-between relative">
                        <div class="absolute top-0 left-1/4 right-1/4 h-1 bg-slate-700 -mt-1"></div><div class="absolute top-0 left-1/4 h-8 w-1 bg-slate-700"></div><div class="absolute top-0 right-1/4 h-8 w-1 bg-slate-700"></div>
                        
                        <!-- Rama Izquierda (Visual) -->
                        <div class="w-5/12 flex flex-col items-center mt-8 space-y-6">
                            <div class="interactive-node bg-slate-800 border border-slate-600 p-4 rounded-xl w-full text-center relative border-l-4 border-l-pink-500" onclick="openNodeDetails('pillow')">
                                <span class="text-xs font-mono text-pink-400 mb-1 block">üì∏ PROCESO</span>
                                <h3 class="font-bold text-white">Pillow</h3>
                            </div>
                            <div class="w-1 h-6 flow-line"></div>
                            <div class="interactive-node bg-gradient-to-b from-slate-800 to-slate-900 border border-purple-500/50 p-4 rounded-xl w-full text-center border-l-4 border-l-purple-500" onclick="openNodeDetails('clip')">
                                <span class="text-xs font-mono text-purple-400 mb-1 block">üß† IA MODEL</span>
                                <h3 class="font-bold text-purple-400">CLIP</h3>
                            </div>
                        </div>

                        <!-- Rama Derecha (Audio) -->
                        <div class="w-5/12 flex flex-col items-center mt-8 space-y-6">
                            <div class="interactive-node bg-slate-800 border border-slate-600 p-4 rounded-xl w-full text-center relative border-l-4 border-l-pink-500" onclick="openNodeDetails('ffmpeg')">
                                <span class="text-xs font-mono text-pink-400 mb-1 block">üéûÔ∏è PROCESO</span>
                                <h3 class="font-bold text-white">FFmpeg</h3>
                            </div>
                            <div class="w-1 h-6 flow-line"></div>
                            <div class="interactive-node bg-gradient-to-b from-slate-800 to-slate-900 border border-purple-500/50 p-4 rounded-xl w-full text-center border-l-4 border-l-purple-500" onclick="openNodeDetails('whisper')">
                                <span class="text-xs font-mono text-purple-400 mb-1 block">üß† IA MODEL</span>
                                <h3 class="font-bold text-purple-400">Whisper</h3>
                            </div>
                        </div>
                    </div>

                    <div class="w-full max-w-2xl h-1 bg-slate-700 mt-4 relative"><div class="absolute left-1/2 -translate-x-1/2 -top-0 w-1 h-8 bg-slate-700"></div></div>
                    
                    <!-- Nivel 3 -->
                    <div class="mt-8 interactive-node bg-slate-900 border-2 border-dashed border-slate-600 p-6 rounded-xl w-full max-w-lg text-center relative border-l-4 border-l-yellow-500" onclick="openNodeDetails('chroma')">
                        <span class="text-xs font-mono text-yellow-400 mb-1 block">üíæ STORAGE</span>
                        <h4 class="font-bold text-green-400">ChromaDB</h4>
                    </div>
                </div>
            </div>
            
            <!-- Modal Detalles -->
            <div id="node-modal" class="hidden absolute top-0 right-0 h-full w-96 bg-slate-900/95 backdrop-blur border-l border-slate-700 shadow-2xl p-6 overflow-y-auto transform transition-transform translate-x-full z-50">
                <button onclick="closeModal('node-modal')" class="absolute top-4 right-4 text-slate-400 hover:text-white"><i class="fa-solid fa-times text-xl"></i></button>
                <div id="modal-content"></div>
            </div>
        </div>

        <!-- VISTA 3: GENERADOR -->
        <div id="view-generator" class="hidden flex-1 overflow-y-auto p-8 relative">
             <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-4 space-y-6">
                    <!-- BIBLIOTECA DE PATRONES -->
                    <div class="bg-slate-900 border border-slate-800 rounded-xl p-5">
                        <div class="flex items-center gap-2 mb-4">
                            <i class="fa-solid fa-book text-amber-400"></i>
                            <h3 class="font-bold text-white text-sm">Biblioteca de Patrones</h3>
                            <span class="text-[10px] bg-amber-500/20 text-amber-400 px-2 py-0.5 rounded-full">15</span>
                        </div>
                        <div id="patterns-accordion" class="space-y-2"></div>
                    </div>

                    <!-- Modo Libre -->
                    <div class="bg-slate-900 border border-slate-800 rounded-xl p-5">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fa-solid fa-pen text-slate-400"></i>
                            <h3 class="font-bold text-white text-sm">Modo Libre</h3>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <label class="text-xs text-slate-500 mb-1 block">Rol</label>
                                <select id="prompt-role" class="w-full bg-slate-950 border border-slate-700 rounded-lg p-2 text-sm text-slate-300">
                                    <option>Arquitecto de Software Senior</option>
                                    <option>Ingeniero de Datos y RAG</option>
                                    <option>Experto en Debugging y Python</option>
                                    <option>Desarrollador Frontend Minimalista</option>
                                    <option>Ingeniero DevOps</option>
                                    <option>Ingeniero de QA</option>
                                    <option>Technical Writer</option>
                                    <option>Ingeniero de Seguridad</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs text-slate-500 mb-1 block">Objetivo</label>
                                <textarea id="prompt-goal" rows="3" class="w-full bg-slate-950 border border-slate-700 rounded-lg p-2.5 text-sm text-slate-300" placeholder="Describe qu√© quieres lograr..."></textarea>
                            </div>
                            <div class="flex flex-wrap gap-1">
                                <button onclick="setGoal('Generar andamiaje (scaffold) inicial de proyecto')" class="text-[10px] bg-slate-800 hover:bg-slate-700 text-slate-400 px-2 py-1 rounded border border-slate-700 transition">üèóÔ∏è Scaffold</button>
                                <button onclick="setGoal('Explicar este c√≥digo l√≠nea por l√≠nea')" class="text-[10px] bg-slate-800 hover:bg-slate-700 text-slate-400 px-2 py-1 rounded border border-slate-700 transition">üìñ Explicar</button>
                                <button onclick="setGoal('Optimizar para rendimiento y concurrencia')" class="text-[10px] bg-slate-800 hover:bg-slate-700 text-slate-400 px-2 py-1 rounded border border-slate-700 transition">üöÄ Optimizar</button>
                            </div>
                        </div>
                    </div>
                    <button onclick="generatePrompt()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl transition active:scale-95">Generar Orden</button>
                </div>
                <div class="lg:col-span-4 bg-slate-900 border border-slate-800 rounded-xl p-5 flex flex-col h-[calc(100vh-8rem)]"><div id="stack-selector" class="overflow-y-auto pr-2 space-y-2 flex-1"></div></div>
                <div class="lg:col-span-4 flex flex-col h-[calc(100vh-8rem)]">
                    <div class="bg-slate-800 border border-slate-700 rounded-xl p-1 flex-1 flex flex-col relative group">
                        <div class="absolute top-4 right-4 z-10 opacity-0 group-hover:opacity-100 transition"><button onclick="copyToClipboard()" class="bg-blue-600 hover:bg-blue-500 text-white text-xs px-3 py-1.5 rounded-md shadow-lg font-medium transition">Copiar</button></div>
                        <div class="bg-slate-950 rounded-lg p-4 flex-1 overflow-y-auto text-xs font-mono text-slate-300 whitespace-pre-wrap" id="prompt-output"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VISTA 4: GLOSARIO + KNOWLEDGE BASE -->
        <div id="view-grid" class="hidden flex-1 overflow-y-auto p-6">
            <!-- Barra de b√∫squeda sem√°ntica -->
            <div class="max-w-2xl mx-auto mb-8">
                <div class="bg-slate-900 border border-slate-800 rounded-xl p-4">
                    <div class="flex items-center gap-3 mb-3">
                        <i class="fa-solid fa-brain text-blue-400"></i>
                        <h3 class="text-sm font-bold text-white">Knowledge Base</h3>
                        <span class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded-full">RAG</span>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="kb-search" class="flex-1 bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-sm text-slate-300 placeholder-slate-600" placeholder="Buscar en tus notas... (ej: ¬øc√≥mo funciona RAG?)">
                        <button onclick="searchKnowledgeBase()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition flex items-center gap-2">
                            <i class="fa-solid fa-search"></i> Buscar
                        </button>
                        <button onclick="indexKnowledgeBase()" class="bg-slate-700 hover:bg-slate-600 text-white px-3 py-2 rounded-lg text-sm transition" title="Indexar archivos">
                            <i class="fa-solid fa-rotate"></i>
                        </button>
                    </div>
                    <!-- Resultados de b√∫squeda -->
                    <div id="kb-results" class="hidden mt-4 space-y-3"></div>
                </div>
            </div>
            <!-- Grid de herramientas -->
            <div id="tools-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"></div>
        </div>
    </main>

    <script>
        // ============================================
        // 1. DATA TOOLS & DETAILS (TAGS CON ICONOS A√ëADIDOS)
        // ============================================
        const tools = [
            // ==========================================
            // üüß FRONTEND (La Cara Visible)
            // ==========================================
            {
                id: "html", name: "HTML5 Sem√°ntico", cat: "Frontend",
                icon: "fa-html5", color: "text-orange-500", tag: "Estructura", status: "used",
                desc: "El esqueleto fundamental de la web moderna.",
                why: "Porque minerOS es 'Local First' y web. Un buen HTML sem√°ntico (<article>, <section>) hace que tus datos sean portables y accesibles sin depender de frameworks.",
                cases: ["Estructura de dashboards", "Reportes generados por IA", "Interfaz de PhotoMine"],
                code: "<article class='card'>\n  <header>\n    <h2>Factura #102</h2>\n  </header>\n  <p>Contenido...</p>\n</article>"
            },
            {
                id: "css", name: "Tailwind CSS", cat: "Frontend",
                icon: "fa-css3", color: "text-blue-400", tag: "Estilos", status: "used",
                desc: "Framework de estilos 'utility-first' para dise√±o r√°pido.",
                why: "Te permite dise√±ar interfaces profesionales (modo oscuro, grids responsive) sin escribir hojas de estilo separadas. Ideal para prototipar r√°pido.",
                cases: ["Layouts de PhotoMine", "Tarjetas del Dashboard", "Botones interactivos"],
                code: "<div class='bg-slate-900 text-white p-4 rounded-xl hover:bg-slate-800 transition shadow-lg'>\n  Panel de Control\n</div>"
            },
            {
                id: "htmx", name: "HTMX", cat: "Frontend",
                icon: "fa-bolt", color: "text-yellow-400", tag: "Interactividad", status: "learning",
                desc: "Superpoderes para HTML. AJAX sin JavaScript complejo.",
                why: "Convierte tus botones y formularios en din√°micos (sin recargar p√°gina) conectando directo con Python. Es la alternativa KISS a React.",
                cases: ["B√∫squeda en vivo", "Carga infinita de fotos", "Edici√≥n inline de datos"],
                code: "<button hx-post='/api/procesar' hx-target='#resultado' hx-swap='innerHTML'>\n  Analizar Imagen\n</button>"
            },
            {
                id: "alpine", name: "Alpine.js", cat: "Frontend",
                icon: "fa-code", color: "text-teal-400", tag: "Reactividad", status: "new",
                desc: "JavaScript minimalista para interacciones en el navegador.",
                why: "Para cuando necesitas abrir un modal, un men√∫ desplegable o pesta√±as sin llamar al servidor. Pesa poqu√≠simo.",
                cases: ["Modales de confirmaci√≥n", "Tabs del Dashboard", "Toggles de visibilidad"],
                code: "<div x-data='{ open: false }'>\n  <button @click='open = true'>Abrir</button>\n  <span x-show='open'>Hola!</span>\n</div>"
            },

            // ==========================================
            // üü© BACKEND (El Cerebro L√≥gico)
            // ==========================================
            {
                id: "python", name: "Python 3.11+", cat: "Backend",
                icon: "fa-brands fa-python", color: "text-blue-500", tag: "Lenguaje Core", status: "used",
                desc: "El lenguaje de programaci√≥n para IA y Datos.",
                why: "Es el pegamento de todo el ecosistema minerOS. Orquesta la IA, mueve archivos y sirve la web.",
                cases: ["Scripts de automatizaci√≥n", "L√≥gica de negocio", "Pegamento entre herramientas"],
                code: "def procesar_archivo(ruta: str) -> dict:\n    datos = extraer_texto(ruta)\n    return {'status': 'ok', 'data': datos}"
            },
            {
                id: "fastapi", name: "FastAPI", cat: "Backend",
                icon: "fa-server", color: "text-green-400", tag: "API Server", status: "learning",
                desc: "El servidor web m√°s r√°pido y moderno para Python.",
                why: "Es as√≠ncrono (no se bloquea mientras la IA piensa). Genera documentaci√≥n autom√°tica (/docs) para que pruebes tus funciones.",
                cases: ["Backend de DirectOS", "API de b√∫squeda", "Endpoint de ingesta de archivos"],
                code: "from fastapi import FastAPI\napp = FastAPI()\n\n@app.get('/items/{id}')\nasync def read_item(id: int):\n    return {'item_id': id}"
            },
            {
                id: "pydantic", name: "Pydantic", cat: "Backend",
                icon: "fa-shield-halved", color: "text-red-400", tag: "Validaci√≥n", status: "new",
                desc: "Control de calidad para tus datos.",
                why: "Define c√≥mo deben ser tus datos (ej: 'La edad debe ser un n√∫mero'). Si algo falla, te avisa antes de romper la base de datos.",
                cases: ["Validar JSON de entrada", "Configuraci√≥n (.env)", "Esquemas de DB"],
                code: "from pydantic import BaseModel\n\nclass Usuario(BaseModel):\n    id: int\n    email: str\n    es_admin: bool = False"
            },
            {
                id: "loguru", name: "Loguru", cat: "Backend",
                icon: "fa-list-ul", color: "text-slate-400", tag: "Logging", status: "learning",
                desc: "Logging simplificado y bonito para humanos.",
                why: "Deja de usar print(). Loguru te dice d√≥nde, cu√°ndo y por qu√© fall√≥ algo, con colores y guardado autom√°tico en archivo.",
                cases: ["Depuraci√≥n de errores", "Historial de operaciones", "Alertas del sistema"],
                code: "from loguru import logger\n\nlogger.add('app.log', rotation='1 day')\nlogger.info('Iniciando proceso...')\nlogger.error('Error cr√≠tico en DB')"
            },
            {
                id: "bs4", name: "BeautifulSoup", cat: "Backend",
                icon: "fa-code", color: "text-green-300", tag: "Scraper", status: "learning",
                desc: "Parser HTML para extraer datos de webs.",
                why: "Cuando necesitas sacar informaci√≥n de p√°ginas web (precios, art√≠culos, datos p√∫blicos) de forma estructurada.",
                cases: ["Scraping de precios", "Extracci√≥n de art√≠culos", "Monitoreo de cambios web"],
                code: "from bs4 import BeautifulSoup\nsoup = BeautifulSoup(html, 'html.parser')\ntitulo = soup.find('h1').text"
            },
            {
                id: "watchdog", name: "Watchdog", cat: "Backend",
                icon: "fa-eye", color: "text-amber-400", tag: "File Watcher", status: "learning",
                desc: "Detecta cambios en carpetas autom√°ticamente.",
                why: "Para pipelines autom√°ticos: cuando guardas un archivo, se procesa solo. Ideal para ingesta continua.",
                cases: ["Auto-indexar Descargas", "Procesar fotos nuevas", "Backup autom√°tico"],
                code: "from watchdog.observers import Observer\nobserver = Observer()\nobserver.schedule(handler, path='./inbox')"
            },

            // ==========================================
            // üü™ IA & MODELOS (La Magia)
            // ==========================================
            {
                id: "clip", name: "OpenAI CLIP", cat: "IA Model",
                icon: "fa-brain", color: "text-purple-400", tag: "Visi√≥n", status: "used",
                desc: "Modelo multimodal que entiende im√°genes y texto.",
                why: "Es el coraz√≥n de PhotoMine. Permite buscar 'perro en la playa' y encontrar la foto sin que nadie la haya etiquetado.",
                cases: ["B√∫squeda sem√°ntica visual", "Clasificaci√≥n autom√°tica", "Detecci√≥n de duplicados"],
                code: "inputs = processor(text=['gato', 'perro'], images=image, return_tensors='pt')\nprobs = model(**inputs).logits_per_image.softmax(dim=1)"
            },
            {
                id: "whisper", name: "Whisper", cat: "IA Model",
                icon: "fa-ear-listen", color: "text-indigo-400", tag: "Audio", status: "learning",
                desc: "Reconocimiento de voz a texto de alta precisi√≥n.",
                why: "Convierte el audio (v√≠deos, notas de voz) en texto que luego puedes buscar, resumir o procesar.",
                cases: ["Transcribir reuniones", "Subt√≠tulos autom√°ticos", "Notas de voz a Obsidian"],
                code: "import whisper\nmodel = whisper.load_model('base')\nresult = model.transcribe('audio.mp3')\nprint(result['text'])"
            },
            {
                id: "sbert", name: "Sentence-BERT", cat: "IA Model",
                icon: "fa-brain", color: "text-teal-400", tag: "Embeddings", status: "used",
                desc: "Vectoriza texto para b√∫squeda sem√°ntica.",
                why: "Convierte p√°rrafos en vectores matem√°ticos. Permite buscar 'documentos similares a este' sin keywords exactas.",
                cases: ["Knowledge Base RAG", "B√∫squeda en notas", "Clustering de documentos"],
                code: "from sentence_transformers import SentenceTransformer\nmodel = SentenceTransformer('all-MiniLM-L6-v2')\nvector = model.encode('Tu texto aqu√≠')"
            },
            {
                id: "claude", name: "Claude API", cat: "IA Model",
                icon: "fa-comments", color: "text-orange-400", tag: "LLM Cloud", status: "used",
                desc: "Razonamiento y generaci√≥n de texto avanzado.",
                why: "Para tareas complejas: resumir, analizar errores, generar c√≥digo. Scout usa Claude para diagnosticar problemas.",
                cases: ["An√°lisis de errores (Scout)", "Res√∫menes inteligentes", "Generaci√≥n de c√≥digo"],
                code: "from anthropic import Anthropic\nclient = Anthropic()\nresponse = client.messages.create(\n  model='claude-sonnet-4-20250514',\n  messages=[{'role': 'user', 'content': prompt}]\n)"
            },
            {
                id: "ollama", name: "Ollama", cat: "IA Model",
                icon: "fa-robot", color: "text-pink-400", tag: "Local LLM", status: "new",
                desc: "Ejecuta modelos tipo ChatGPT (Llama 3, Mistral) en tu Mac.",
                why: "Privacidad total. Te permite tener un asistente inteligente que lee tus documentos privados sin subirlos a la nube.",
                cases: ["Resumir documentos sensibles", "Chatbot offline", "Extracci√≥n de datos privados"],
                code: "# En terminal:\nollama run llama3\n# O desde Python:\nimport ollama\nollama.chat(model='llama3', messages=[...])"
            },

            // ==========================================
            // üü® DATOS & ALMACENAMIENTO (La Memoria)
            // ==========================================
            {
                id: "chroma", name: "ChromaDB", cat: "Storage",
                icon: "fa-database", color: "text-emerald-400", tag: "Vector DB", status: "used",
                desc: "Base de datos para guardar vectores (embeddings).",
                why: "Es donde vive la 'memoria sem√°ntica' de minerOS. Permite buscar por significado ('algo parecido a esto') en lugar de palabras exactas.",
                cases: ["Motor de b√∫squeda RAG", "Recomendaciones", "Memoria de chatbot"],
                code: "collection = client.get_collection('fotos')\nresults = collection.query(query_texts=['atardecer'], n_results=5)"
            },
            {
                id: "sqlite", name: "SQLite", cat: "Storage",
                icon: "fa-table", color: "text-blue-300", tag: "Relacional", status: "used",
                desc: "Base de datos SQL en un archivo √∫nico.",
                why: "Perfecta para metadatos estructurados (fechas, nombres, rutas). Es robusta, r√°pida y no necesita servidor.",
                cases: ["√çndice de archivos", "Registro de usuarios", "Logs estructurados"],
                code: "import sqlite3\ncon = sqlite3.connect('mineros.db')\ncon.execute('SELECT * FROM docs WHERE fecha > ?', ('2024-01-01',))"
            },
            {
                id: "markdown", name: "Markdown", cat: "Storage",
                icon: "fa-file-lines", color: "text-slate-300", tag: "Archivos", status: "used",
                desc: "Formato de texto plano para notas y documentaci√≥n.",
                why: "Es el formato universal de conocimiento. Compatible con Obsidian, GitHub, y f√°cil de procesar con IA.",
                cases: ["Notas de aprendizaje", "Documentaci√≥n de proyectos", "Knowledge Base"],
                code: "# T√≠tulo\n## Subt√≠tulo\n- Lista de items\n- **Negrita** y *cursiva*\n```python\ncodigo()\n```"
            },

            // ==========================================
            // üü• PROCESAMIENTO (Los Obreros)
            // ==========================================
            {
                id: "opencv", name: "OpenCV / Pillow", cat: "Process",
                icon: "fa-eye", color: "text-red-400", tag: "Visi√≥n", status: "used",
                desc: "Librer√≠as para manipular im√°genes p√≠xel a p√≠xel.",
                why: "Necesarias para preparar las im√°genes antes de pasarlas a la IA (redimensionar, recortar, convertir formato).",
                cases: ["Generar miniaturas", "Detectar caras", "Normalizar para CLIP"],
                code: "from PIL import Image\nimg = Image.open('foto.jpg').resize((224, 224))\nimg.save('thumb.jpg')"
            },
            {
                id: "ffmpeg", name: "FFmpeg", cat: "Process",
                icon: "fa-film", color: "text-pink-400", tag: "Multimedia", status: "learning",
                desc: "La navaja suiza del v√≠deo y audio.",
                why: "Permite extraer el audio de un v√≠deo para Whisper, o sacar fotogramas cada 5 segundos para CLIP.",
                cases: ["Extraer audio de v√≠deo", "Comprimir v√≠deos", "Generar GIFs"],
                code: "import subprocess\nsubprocess.run(['ffmpeg', '-i', 'video.mp4', '-vn', 'audio.mp3'])"
            },
            {
                id: "ocr", name: "Tesseract OCR", cat: "Process",
                icon: "fa-font", color: "text-cyan-400", tag: "OCR", status: "learning",
                desc: "Extrae texto de im√°genes y PDFs escaneados.",
                why: "Para digitalizar documentos f√≠sicos (facturas, recibos) y hacerlos buscables.",
                cases: ["Escanear facturas", "Digitalizar notas a mano", "Extraer texto de capturas"],
                code: "import pytesseract\nfrom PIL import Image\ntexto = pytesseract.image_to_string(Image.open('scan.png'))"
            },

            // ==========================================
            // ‚¨õ DEVOPS & CALIDAD (El Taller)
            // ==========================================
            {
                id: "git", name: "Git", cat: "DevOps",
                icon: "fa-code-branch", color: "text-orange-400", tag: "Versiones", status: "learning",
                desc: "Sistema de control de versiones.",
                why: "Tu red de seguridad. Te permite experimentar sin miedo a romper nada, pudiendo volver atr√°s en el tiempo.",
                cases: ["Guardar progreso", "Probar features nuevas (ramas)", "Backup en GitHub"],
                code: "git init\ngit add .\ngit commit -m 'A√±adido nuevo parser'"
            },
            {
                id: "ruff", name: "Ruff / Black", cat: "DevOps",
                icon: "fa-check-double", color: "text-yellow-200", tag: "Calidad", status: "new",
                desc: "Herramientas de limpieza y formateo de c√≥digo.",
                why: "Hacen que tu c√≥digo se vea profesional autom√°ticamente. Black formatea y Ruff busca errores.",
                cases: ["Formatear al guardar", "Detectar imports no usados", "Estilo consistente"],
                code: "# En terminal\nruff check .\nblack ."
            }
        ];

        // ============================================
        // PATRONES DE ARQUITECTURA (PRESETS)
        // ============================================
        const presets = [
            {
                id: "rag-chatbot",
                name: "üß† Cerebro de Segunda Memoria",
                desc: "RAG Chatbot - Chatea con tus PDFs/Apuntes",
                useCase: "farmaIA, DocMine",
                tools: ["fastapi", "sbert", "chroma", "claude", "htmx"],
                flow: "Pregunta ‚Üí Vector ‚Üí Busca contexto ‚Üí LLM responde"
            },
            {
                id: "video-search",
                name: "ü¶Ö Ojo de Halc√≥n",
                desc: "Video Search - Encuentra momentos por texto o imagen",
                useCase: "VideoMine, PhotoMine++",
                tools: ["ffmpeg", "whisper", "clip", "sqlite", "fastapi"],
                flow: "Video ‚Üí Escenas + Audio ‚Üí Indexa ‚Üí Busca"
            },
            {
                id: "smart-scraper",
                name: "üïµÔ∏è Agente Curador",
                desc: "Smart Scraper - Extrae datos limpios de webs",
                useCase: "Investigaci√≥n, precios",
                tools: ["python", "bs4", "claude", "sqlite", "loguru"],
                flow: "URL ‚Üí HTML ‚Üí LLM extrae JSON ‚Üí Guarda"
            },
            {
                id: "voice-notes",
                name: "üé§ Escriba Silencioso",
                desc: "Voice-to-Knowledge - Notas de voz a texto estructurado",
                useCase: "Diario, ideas, reuniones",
                tools: ["whisper", "python", "claude", "markdown"],
                flow: "Audio ‚Üí Transcribe ‚Üí LLM resume ‚Üí Guarda .md"
            },
            {
                id: "auto-tagger",
                name: "üëª Clasificador Fantasma",
                desc: "Auto-Tagging - Organiza archivos por contenido",
                useCase: "Descargas, Escritorio",
                tools: ["watchdog", "clip", "ocr", "chroma", "python"],
                flow: "Detecta archivo ‚Üí Analiza ‚Üí Clasifica ‚Üí Mueve"
            },
            {
                id: "text-to-sql",
                name: "üîÆ Or√°culo de Datos",
                desc: "Text-to-SQL - Pregunta a tu BD en lenguaje natural",
                useCase: "Farmacia, Fiscalidad",
                tools: ["fastapi", "claude", "python", "sqlite", "htmx"],
                flow: "Pregunta ‚Üí LLM genera SQL ‚Üí Ejecuta ‚Üí Muestra"
            }
        ];
        
        const catStyles = { "Frontend": "cat-frontend", "Backend": "cat-backend", "IA Model": "cat-ai", "Storage": "cat-storage", "Process": "cat-process", "DevOps": "cat-devops" };
        const statusLabels = { "used": "‚úÖ Dominada", "learning": "üöß En progreso", "new": "üÜï Por descubrir" };

        // ============================================
        // BIBLIOTECA DE PATRONES DE PROMPTS
        // ============================================
        const promptPatterns = {
            "refactoring": {
                name: "üîß Refactoring",
                icon: "fa-wrench",
                patterns: [
                    {
                        id: "refactorizador-modular",
                        name: "Refactorizador Modular",
                        emoji: "üèóÔ∏è",
                        problem: "Tienes un script prueba.py de 300 l√≠neas que funciona, pero es un caos.",
                        prompt: `Act√∫a como Arquitecto de Software. Toma este c√≥digo monol√≠tico y refactor√≠zalo siguiendo la arquitectura limpia de minerOS. Sep√°ralo en: routers/ (endpoints), services/ (l√≥gica pura), y core/ (configuraci√≥n). Usa inyecci√≥n de dependencias y Pydantic para validaci√≥n. Entr√©game la estructura de archivos final.`,
                        flow: ["python", "fastapi", "loguru"],
                        flowDesc: "Script ‚Üí Analiza ‚Üí Separa m√≥dulos ‚Üí Estructura limpia"
                    },
                    {
                        id: "guardian-calidad",
                        name: "Guardi√°n de Calidad",
                        emoji: "üõ°Ô∏è",
                        problem: "Tienes miedo de tocar el c√≥digo porque se puede romper.",
                        prompt: `Act√∫a como Ingeniero de QA experto en Pytest. Genera una suite de tests completa para este m√≥dulo. Incluye conftest.py con fixtures para mockear la base de datos y las llamadas a APIs externas (como OpenAI). Cubre casos de √©xito, casos de error y casos borde.`,
                        flow: ["python", "sqlite", "loguru"],
                        flowDesc: "C√≥digo ‚Üí Analiza ‚Üí Genera tests ‚Üí conftest.py + tests/"
                    },
                    {
                        id: "constructor-interfaz",
                        name: "Constructor de Interfaz",
                        emoji: "üé®",
                        problem: "Tienes la API hecha pero te da pereza hacer el HTML.",
                        prompt: `Act√∫a como Desarrollador Frontend Minimalista. Teniendo en cuenta este esquema de datos Pydantic del backend, genera un componente HTML5 + TailwindCSS aut√≥nomo. Usa HTMX para conectar con el endpoint sin escribir JavaScript. El dise√±o debe ser limpio, oscuro (Slate-900) y mobile-first.`,
                        flow: ["html", "css", "htmx", "fastapi"],
                        flowDesc: "Pydantic Schema ‚Üí HTML5 + Tailwind ‚Üí HTMX bindings"
                    }
                ]
            },
            "contenido": {
                name: "üìù Contenido",
                icon: "fa-pen-fancy",
                patterns: [
                    {
                        id: "alquimista-contenido",
                        name: "Alquimista de Contenido",
                        emoji: "‚ú®",
                        problem: "Tienes un archivo Markdown t√©cnico y quieres convertirlo en contenido publicable.",
                        prompt: `Act√∫a como Content Strategist t√©cnico. Toma este archivo Markdown y genera: 1) Un hilo de Twitter de 5 tweets con hooks y emojis, 2) Un post de LinkedIn profesional con bullet points, 3) Una Newsletter HTML maquetada. Mant√©n el tono t√©cnico pero accesible.`,
                        flow: ["python", "claude", "clip", "html", "sqlite"],
                        flowDesc: "Markdown ‚Üí IA extrae ideas ‚Üí Genera formatos ‚Üí HTML Newsletter"
                    }
                ]
            },
            "seguridad": {
                name: "üõ°Ô∏è Seguridad",
                icon: "fa-shield-halved",
                patterns: [
                    {
                        id: "escudo-privacidad",
                        name: "Escudo de Privacidad",
                        emoji: "üîí",
                        problem: "Necesitas compartir logs o documentos pero contienen datos sensibles.",
                        prompt: `Act√∫a como Ingeniero de Seguridad. Crea un script Python que escanee archivos recursivamente, detecte datos sensibles (DNI, Email, Tel√©fono, API Keys, IBANs) usando regex y opcionalmente Spacy NER, y genere una copia censurada con [REDACTED]. Usa Loguru para alertar cada hallazgo. Sin APIs externas - todo local.`,
                        flow: ["python", "ocr", "loguru"],
                        flowDesc: "Archivos ‚Üí OCR si es imagen ‚Üí Regex/Spacy detecta ‚Üí Copia censurada"
                    }
                ]
            },
            "knowledge": {
                name: "üß† Knowledge",
                icon: "fa-brain",
                patterns: [
                    {
                        id: "sintetizador-conocimiento",
                        name: "Sintetizador de Conocimiento",
                        emoji: "üìö",
                        problem: "Tienes 50 PDFs sobre un tema y necesitas un resumen coherente.",
                        prompt: `Act√∫a como Investigador Senior. Genera un "Estado del Arte" sobre el tema especificado bas√°ndote √∫nicamente en los fragmentos recuperados de mi Knowledge Base local. Estructura el ensayo con: Introducci√≥n, Conceptos clave, Evoluci√≥n hist√≥rica, Estado actual, y Conclusiones. Cita las fuentes originales.`,
                        flow: ["fastapi", "chroma", "python", "claude", "html"],
                        flowDesc: "Tema ‚Üí ChromaDB busca ‚Üí Reranking ‚Üí LLM sintetiza ‚Üí Informe HTML"
                    }
                ]
            },
            "aprendizaje": {
                name: "üìñ Aprendizaje",
                icon: "fa-graduation-cap",
                patterns: [
                    {
                        id: "mentor-socratico",
                        name: "Mentor Socr√°tico",
                        emoji: "üéì",
                        problem: "Quieres comprobar si realmente entendiste un documento t√©cnico.",
                        prompt: `Act√∫a como profesor universitario experto en evaluaci√≥n. Lee este documento t√©cnico y genera un test de 10 preguntas tipo test (4 opciones, solo 1 correcta). Incluye preguntas de comprensi√≥n, aplicaci√≥n y an√°lisis. Devuelve un JSON con: pregunta, opciones[], respuesta_correcta, explicacion.`,
                        flow: ["python", "claude", "htmx", "markdown"],
                        flowDesc: "PDF/MD ‚Üí LLM genera quiz ‚Üí JSON ‚Üí Interfaz Flashcards"
                    },
                    {
                        id: "resumen-ejecutivo",
                        name: "Resumen Ejecutivo",
                        emoji: "üìã",
                        problem: "Al final del d√≠a no recuerdas qu√© guardaste en tus carpetas.",
                        prompt: `Act√∫a como Asistente Personal. Escanea los archivos creados/modificados en las √∫ltimas 24 horas en la carpeta especificada. Para cada archivo, extrae su "esencia" (t√≠tulo, tipo, tema principal). Genera un resumen narrativo de 1 p√°rrafo: "Hoy guardaste 3 facturas, 2 notas de voz sobre X, y 1 snippet de c√≥digo para Y".`,
                        flow: ["python", "watchdog", "ocr", "clip", "claude", "markdown"],
                        flowDesc: "Watchdog ‚Üí Clasifica archivos ‚Üí IA resume ‚Üí DIARIO.md"
                    },
                    {
                        id: "torre-babel",
                        name: "Torre de Babel",
                        emoji: "üåç",
                        problem: "Necesitas leer documentaci√≥n t√©cnica en otro idioma.",
                        prompt: `Act√∫a como Traductor T√©cnico especializado. Traduce este documento manteniendo: 1) Bloques de c√≥digo intactos, 2) Nombres de variables/funciones sin traducir, 3) Terminolog√≠a t√©cnica est√°ndar (API, endpoint, etc). Genera una versi√≥n biling√ºe lado a lado si es posible.`,
                        flow: ["python", "claude", "html", "markdown"],
                        flowDesc: "Markdown ‚Üí Separa c√≥digo/texto ‚Üí Traduce texto ‚Üí Re-ensambla"
                    }
                ]
            },
            "devops": {
                name: "üîß DevOps",
                icon: "fa-code",
                patterns: [
                    {
                        id: "code-reviewer",
                        name: "Code Reviewer",
                        emoji: "üëÄ",
                        problem: "Quieres un segundo par de ojos antes de hacer commit.",
                        prompt: `Act√∫a como Senior Python Developer con 10 a√±os de experiencia. Revisa este c√≥digo buscando: 1) Vulnerabilidades de seguridad (inyecci√≥n, exposici√≥n de secrets), 2) Problemas de rendimiento (N+1, memory leaks), 3) Falta de type hints, 4) Code smells (funciones largas, acoplamiento). Prioriza los hallazgos por severidad.`,
                        flow: ["python", "loguru"],
                        flowDesc: "C√≥digo ‚Üí An√°lisis est√°tico ‚Üí IA review ‚Üí Reporte priorizado"
                    },
                    {
                        id: "semilla-datos",
                        name: "Semilla de Datos",
                        emoji: "üå±",
                        problem: "Necesitas datos de prueba realistas sin usar datos reales de producci√≥n.",
                        prompt: `Act√∫a como Ingeniero de Datos. Genera un dataset de prueba con el esquema especificado. Los datos deben ser: 1) Coherentes entre s√≠ (edades realistas, nombres plausibles), 2) Diversos (cubrir casos borde), 3) En formato JSON/CSV. Incluye al menos 100 registros.`,
                        flow: ["fastapi", "claude", "python", "sqlite"],
                        flowDesc: "Esquema ‚Üí LLM genera JSON ‚Üí Valida Pydantic ‚Üí Inserta SQLite"
                    },
                    {
                        id: "documentador-fantasma",
                        name: "Documentador Fantasma",
                        emoji: "üëª",
                        problem: "Tu c√≥digo funciona pero no tiene documentaci√≥n.",
                        prompt: `Act√∫a como Technical Writer. Lee este m√≥dulo Python usando AST y genera: 1) Docstrings en formato Google Style para cada funci√≥n, 2) Un README.md con: descripci√≥n, instalaci√≥n, uso b√°sico, y ejemplos. 3) Un diagrama ASCII del flujo principal. No inventes funcionalidad - documenta solo lo que existe.`,
                        flow: ["python", "claude", "markdown"],
                        flowDesc: "C√≥digo ‚Üí AST extrae estructura ‚Üí LLM documenta ‚Üí docs/"
                    }
                ]
            },
            "debug": {
                name: "üîç Debug & Performance",
                icon: "fa-bug",
                patterns: [
                    {
                        id: "debugger-sherlock",
                        name: "Debugger Sherlock",
                        emoji: "üîç",
                        problem: "Tienes un error cr√≠ptico y no sabes por d√≥nde empezar.",
                        prompt: `Act√∫a como Detective de Bugs Senior. Analiza este traceback como Sherlock Holmes. Identifica: 1) La l√≠nea exacta del fallo y tipo de excepci√≥n, 2) El contexto (qu√© datos entraron), 3) 3 hip√≥tesis ordenadas por probabilidad, 4) Plan de debugging paso a paso con prints/breakpoints estrat√©gicos. No asumas - deduce desde la evidencia.`,
                        flow: ["python", "loguru", "claude"],
                        flowDesc: "Traceback ‚Üí Analiza contexto ‚Üí Hip√≥tesis ‚Üí Plan de acci√≥n"
                    },
                    {
                        id: "performance-hunter",
                        name: "Performance Hunter",
                        emoji: "‚ö°",
                        problem: "Tu script funciona pero tarda demasiado.",
                        prompt: `Act√∫a como Performance Engineer. Analiza este c√≥digo Python buscando: 1) Loops O(n¬≤) convertibles a O(n) con sets/dicts, 2) Operaciones I/O bloqueantes que podr√≠an ser async, 3) Memory allocations innecesarias en loops, 4) Candidatos para caching (@lru_cache). Prioriza por impacto/esfuerzo. Dame el c√≥digo optimizado.`,
                        flow: ["python", "loguru"],
                        flowDesc: "C√≥digo lento ‚Üí Profiling mental ‚Üí Identificar hotspots ‚Üí Optimizar"
                    }
                ]
            },
            "data-api": {
                name: "üóÇÔ∏è Data & API",
                icon: "fa-database",
                patterns: [
                    {
                        id: "schema-detective",
                        name: "Schema Detective",
                        emoji: "üóÇÔ∏è",
                        problem: "Recibes un JSON/CSV gigante y necesitas entender su estructura.",
                        prompt: `Act√∫a como Data Analyst. Analiza este dataset (JSON/CSV) y genera: 1) Modelo Pydantic con tipos inferidos autom√°ticamente, 2) Campos opcionales (Optional[]) vs requeridos detectados, 3) Valores √∫nicos que deber√≠an ser Enums, 4) Relaciones entre entidades si existen. Formato listo para copiar a models.py.`,
                        flow: ["python", "fastapi", "sqlite"],
                        flowDesc: "JSON/CSV ‚Üí Inferir tipos ‚Üí Generar Pydantic ‚Üí models.py"
                    },
                    {
                        id: "api-architect",
                        name: "API Architect",
                        emoji: "üèõÔ∏è",
                        problem: "Sabes qu√© necesitas pero no c√≥mo dise√±ar los endpoints.",
                        prompt: `Act√∫a como API Designer experto en REST. Dado este dominio de negocio, dise√±a una API RESTful completa: 1) Recursos y rutas (GET/POST/PUT/DELETE), 2) Esquemas Pydantic de request/response, 3) C√≥digos HTTP espec√≠ficos (201, 204, 404, 422), 4) Ejemplo curl de cada endpoint. Estilo FastAPI, listo para implementar.`,
                        flow: ["fastapi", "python", "sqlite"],
                        flowDesc: "Dominio ‚Üí Identificar recursos ‚Üí Dise√±ar rutas ‚Üí Schemas"
                    }
                ]
            },
            "meta": {
                name: "üéØ Meta & Automation",
                icon: "fa-wand-magic-sparkles",
                patterns: [
                    {
                        id: "prompt-optimizer",
                        name: "Prompt Optimizer",
                        emoji: "üéØ",
                        problem: "Tu prompt funciona a medias, a veces da respuestas inconsistentes.",
                        prompt: `Act√∫a como Prompt Engineer Senior. Analiza este prompt y mej√≥ralo aplicando: 1) Rol espec√≠fico con expertise, 2) Formato de salida estructurado (JSON, Markdown), 3) Ejemplos few-shot si el patr√≥n es complejo, 4) Restricciones expl√≠citas (qu√© NO hacer), 5) Pensamiento paso a paso si requiere razonamiento. Devuelve: versi√≥n original vs mejorada.`,
                        flow: ["claude", "markdown"],
                        flowDesc: "Prompt d√©bil ‚Üí An√°lisis ‚Üí Aplicar t√©cnicas ‚Üí Prompt robusto"
                    },
                    {
                        id: "workflow-automator",
                        name: "Workflow Automator",
                        emoji: "ü§ñ",
                        problem: "Haces lo mismo manualmente cada d√≠a (renombrar, mover, procesar).",
                        prompt: `Act√∫a como Automation Engineer. Dado este flujo manual, genera un script Python con Watchdog que: 1) Detecte archivos nuevos por patr√≥n (*.pdf, *.jpg), 2) Ejecute la acci√≥n autom√°ticamente, 3) Loguee cada operaci√≥n con Loguru, 4) Tenga modo --dry-run para probar. Sin dependencias innecesarias. Local-first.`,
                        flow: ["python", "watchdog", "loguru"],
                        flowDesc: "Describir flujo ‚Üí Watchdog detecta ‚Üí Acci√≥n ‚Üí Log"
                    }
                ]
            },
            "ui-creative": {
                name: "üé® Creatividad & UI",
                icon: "fa-palette",
                patterns: [
                    {
                        id: "pincel-digital",
                        name: "Pincel Digital",
                        emoji: "üñåÔ∏è",
                        problem: "Tienes un HTML funcional pero feo. Quieres que parezca SaaS profesional.",
                        prompt: `Act√∫a como Dise√±ador UI/UX Senior experto en Tailwind CSS. Toma este HTML crudo y redis√©√±alo para que sea moderno, oscuro y minimalista. Requisitos: Gradientes sutiles (slate-900‚Üíslate-950), tipograf√≠a Inter, micro-interacciones (hover, transiciones 200ms), sombras para profundidad. Mant√©n la estructura funcional intacta.`,
                        flow: ["html", "css", "htmx"],
                        flowDesc: "HTML feo ‚Üí An√°lisis UX ‚Üí Tailwind magic ‚Üí HTML profesional"
                    },
                    {
                        id: "narrador-datos",
                        name: "Narrador de Datos",
                        emoji: "üìä",
                        problem: "Tienes datos en SQLite/Python pero verlos en tablas es aburrido.",
                        prompt: `Act√∫a como Experto en Visualizaci√≥n de Datos. Tengo este dataset JSON. Genera c√≥digo HTML + JS usando Chart.js para un dashboard interactivo: gr√°fico de l√≠nea temporal, donut para distribuci√≥n por categor√≠as, tarjetas KPI con totales. Paleta ne√≥n (cyan, magenta, amarillo) sobre fondo slate-900.`,
                        flow: ["html", "python", "sqlite"],
                        flowDesc: "Datos ‚Üí Elegir visualizaci√≥n ‚Üí Chart.js ‚Üí Dashboard"
                    },
                    {
                        id: "arquitecto-componentes",
                        name: "Arquitecto de Componentes",
                        emoji: "üß±",
                        problem: "Repites mucho c√≥digo HTML (tarjetas, botones, men√∫s).",
                        prompt: `Act√∫a como Frontend Developer experto en DRY. Extrae este bloque de HTML repetitivo y convi√©rtelo en: A) Macro de Jinja2, B) Template con slots, o C) Componente Alpine.js. Que acepte par√°metros: t√≠tulo, imagen, estado, onClick. Incluye ejemplo instanci√°ndolo 3 veces con datos diferentes.`,
                        flow: ["html", "htmx", "python"],
                        flowDesc: "HTML repetido ‚Üí Identificar variaciones ‚Üí Parametrizar ‚Üí Componente"
                    }
                ]
            },
            "robustez": {
                name: "üõ†Ô∏è Ingenier√≠a & Robustez",
                icon: "fa-hammer",
                patterns: [
                    {
                        id: "comandante-terminal",
                        name: "Comandante de Terminal",
                        emoji: "‚å®Ô∏è",
                        problem: "Ejecutar scripts editando variables en el c√≥digo es cutre.",
                        prompt: `Act√∫a como Python Tooling Expert. Convierte este script en una CLI profesional con Typer. Requisitos: Comandos claros (scan, process, clean), opciones con defaults, barras de progreso con rich/tqdm, ayuda autom√°tica (--help), colores para √©xito/error, manejo de Ctrl+C graceful.`,
                        flow: ["python", "loguru"],
                        flowDesc: "Script ‚Üí Identificar inputs ‚Üí Typer CLI ‚Üí Instalable con pip"
                    },
                    {
                        id: "cirujano-datos",
                        name: "Cirujano de Datos",
                        emoji: "üî¨",
                        problem: "Tus consultas a SQLite empiezan a ir lentas.",
                        prompt: `Act√∫a como DBA experto en SQLite. Analiza este esquema y consulta SQL lenta. Tareas: 1) Identificar cuellos de botella (table scans, joins sin √≠ndice), 2) Sugerir √≠ndices (CREATE INDEX), 3) Normalizar si hay redundancia, 4) Reescribir query optimizada, 5) Explicar con EXPLAIN QUERY PLAN.`,
                        flow: ["sqlite", "python"],
                        flowDesc: "Schema + Query ‚Üí EXPLAIN ‚Üí √çndices ‚Üí Query optimizada"
                    },
                    {
                        id: "centinela-errores",
                        name: "Centinela de Errores",
                        emoji: "üõ°Ô∏è",
                        problem: "Tu script se rompe si falta internet o un archivo.",
                        prompt: `Act√∫a como SRE (Site Reliability Engineer). Envuelve este c√≥digo en estructura robusta de errores: Excepciones espec√≠ficas (NetworkError, FileNotFoundError), retry con backoff exponencial (3 intentos: 1s‚Üí2s‚Üí4s), fallback graceful, Loguru para registrar timestamp/intento/error/contexto.`,
                        flow: ["python", "loguru"],
                        flowDesc: "C√≥digo fr√°gil ‚Üí Identificar fallos ‚Üí try/except ‚Üí Retry ‚Üí Log"
                    }
                ]
            },
            "data-eng": {
                name: "üßπ Data Engineering",
                icon: "fa-broom",
                patterns: [
                    {
                        id: "conserje-datos",
                        name: "Conserje de Datos",
                        emoji: "üßπ",
                        problem: "Tienes un CSV/JSON sucio con fechas mixtas, nulos y duplicados.",
                        prompt: `Act√∫a como Data Engineer. Genera script de limpieza con Pandas: 1) Estandarizar fechas a ISO 8601, 2) Manejar nulos (media para num√©ricos, "UNKNOWN" para strings), 3) Eliminar duplicados por columnas clave, 4) Detectar outliers (>3 std), 5) Exportar CSV limpio + quality_report.json.`,
                        flow: ["python", "sqlite"],
                        flowDesc: "CSV sucio ‚Üí Pandas ‚Üí Limpieza ‚Üí CSV limpio + reporte"
                    },
                    {
                        id: "susurrador-regex",
                        name: "Susurrador de Regex",
                        emoji: "üîÆ",
                        problem: "Necesitas extraer informaci√≥n de texto no estructurado (logs, emails).",
                        prompt: `Act√∫a como experto en Expresiones Regulares de Python. Necesito extraer [PATR√ìN: IBANs, referencias catastrales, fechas, etc] de este texto. Para cada patr√≥n: 1) Regex comentada paso a paso, 2) C√≥digo Python con re.findall(), 3) Tests con casos borde (qu√© matchea y qu√© no).`,
                        flow: ["python", "loguru"],
                        flowDesc: "Texto ‚Üí Identificar patr√≥n ‚Üí Regex ‚Üí Extraer ‚Üí Lista limpia"
                    },
                    {
                        id: "traductor-formatos",
                        name: "Traductor de Formatos",
                        emoji: "üîÑ",
                        problem: "Necesitas mover datos entre sistemas incompatibles (XML‚ÜíSQLite).",
                        prompt: `Act√∫a como Integration Engineer. Genera script de migraci√≥n en Python: 1) Parsear origen (lxml para XML, openpyxl para Excel), 2) Transformar al esquema destino, 3) Validar con Pydantic antes de insertar, 4) Manejar errores por registro (no fallar todo por uno), 5) Log de migraci√≥n: exitosos/fallidos/warnings.`,
                        flow: ["python", "sqlite", "fastapi"],
                        flowDesc: "Origen ‚Üí Parse ‚Üí Transform ‚Üí Validate ‚Üí Load ‚Üí Log"
                    }
                ]
            },
            "docs-visual": {
                name: "üìê Documentaci√≥n Visual",
                icon: "fa-diagram-project",
                patterns: [
                    {
                        id: "diagramador-auto",
                        name: "Diagramador Autom√°tico",
                        emoji: "üìê",
                        problem: "Necesitas explicar un flujo visualmente pero dibujar es tedioso.",
                        prompt: `Act√∫a como Technical Illustrator. Analiza este c√≥digo/flujo y genera c√≥digo Mermaid.js. Tipos: Secuencia (Frontend‚ÜíAPI‚ÜíDB), Flowchart (if/else), ER (relaciones tablas), State (estados proceso). Output: c√≥digo Mermaid listo para GitHub/Notion + preview ASCII si es posible.`,
                        flow: ["markdown", "python"],
                        flowDesc: "C√≥digo/descripci√≥n ‚Üí Elegir tipo ‚Üí Mermaid.js ‚Üí Diagrama"
                    },
                    {
                        id: "bibliotecario-api",
                        name: "Bibliotecario de API",
                        emoji: "üìö",
                        problem: "Tu API funciona pero no tiene documentaci√≥n para otros devs.",
                        prompt: `Act√∫a como API Documentation Specialist. Genera documentaci√≥n OpenAPI 3.0 (Swagger) en YAML: Paths con m√©todos HTTP, Request/Response schemas, C√≥digos de error (400, 404, 500), Ejemplos realistas, Tags por recurso. Bonus: docstring para que FastAPI auto-genere /docs.`,
                        flow: ["fastapi", "python", "markdown"],
                        flowDesc: "C√≥digo ‚Üí Extraer endpoints ‚Üí OpenAPI YAML ‚Üí /docs autom√°tico"
                    },
                    {
                        id: "gestor-entorno",
                        name: "Gestor de Entorno",
                        emoji: "‚öôÔ∏è",
                        problem: "Tienes API keys y rutas hardcodeadas en el c√≥digo.",
                        prompt: `Act√∫a como DevOps Engineer. Analiza este script e identifica variables de configuraci√≥n: API Keys, rutas, URLs, puertos, feature flags. Refactoriza usando python-dotenv + Pydantic Settings. Genera .env.example con placeholders. A√±ade validaci√≥n (app no arranca si falta ANTHROPIC_API_KEY).`,
                        flow: ["python", "fastapi", "loguru"],
                        flowDesc: "C√≥digo ‚Üí Identificar config ‚Üí .env + Settings ‚Üí Validaci√≥n"
                    }
                ]
            },
            "comodin": {
                name: "üÉè Comod√≠n",
                icon: "fa-hat-wizard",
                patterns: [
                    {
                        id: "meta-patron",
                        name: "Meta-Patr√≥n",
                        emoji: "üÉè",
                        problem: "Necesitas un patr√≥n que no existe en esta lista.",
                        prompt: `Act√∫a como Prompt Architect de minerOS. Necesito un nuevo patr√≥n de prompt para [DESCRIBIR PROBLEMA]. Genera siguiendo esta estructura: Nombre creativo + emoji, El Problema (1 frase), El Prompt completo, Flujo T√°ctico (herramientas), Ejemplo de uso real.`,
                        flow: ["claude", "markdown"],
                        flowDesc: "Problema ‚Üí Dise√±ar patr√≥n ‚Üí Prompt + Flujo ‚Üí Ejemplo"
                    },
                    {
                        id: "auditor-proyecto",
                        name: "Auditor de Proyecto",
                        emoji: "üîé",
                        problem: "Heredas un proyecto y no sabes por d√≥nde empezar.",
                        prompt: `Act√∫a como Tech Lead haciendo due diligence. Escanea este proyecto y genera informe: 1) Stack detectado (lenguajes, frameworks, DBs), 2) Estructura de carpetas, 3) Puntos de entrada (main.py, index.html), 4) Dependencias cr√≠ticas, 5) Red flags: c√≥digo muerto, secrets expuestos, deuda t√©cnica, 6) Siguiente paso recomendado.`,
                        flow: ["python", "loguru", "markdown"],
                        flowDesc: "Proyecto ‚Üí Escanear ‚Üí Analizar ‚Üí Informe ejecutivo"
                    },
                    {
                        id: "simplificador-kiss",
                        name: "Simplificador KISS",
                        emoji: "‚úÇÔ∏è",
                        problem: "Sospechas que tu c√≥digo est√° sobre-engineered.",
                        prompt: `Act√∫a como Senior Developer minimalista. Revisa este c√≥digo con filosof√≠a KISS. Identifica: 1) Abstracciones prematuras (clases usadas una vez), 2) Patrones de dise√±o innecesarios, 3) Configuraci√≥n excesiva, 4) C√≥digo "por si acaso" que nunca se ejecuta. Para cada hallazgo: c√≥digo actual vs versi√≥n simplificada.`,
                        flow: ["python", "loguru"],
                        flowDesc: "C√≥digo complejo ‚Üí Identificar excesos ‚Üí Simplificar ‚Üí KISS"
                    }
                ]
            }
        };

        const nodeDetails = { 
            fastapi: { title: "FastAPI", role: "Arquitecto Senior", desc: "Servidor as√≠ncrono. Maneja las peticiones de entrada.", code: "@app.post('/ingest')\nasync def ingest(file: UploadFile):\n    await process_file(file)\n    return {'status': 'ok'}", goal: "Crear endpoint no bloqueante para subida de archivos." }, 
            chroma: { title: "ChromaDB", role: "Arquitecto Datos", desc: "Base de datos vectorial para b√∫squeda sem√°ntica.", code: "client = chromadb.PersistentClient(path='./db')\ncollection.add(embeddings=[vector])", goal: "Configurar cliente persistente y esquema de colecci√≥n." },
            pillow: { title: "Pillow / OpenCV", role: "Ingeniero Datos", desc: "Pre-procesado de imagen: redimensi√≥n y normalizaci√≥n.", code: "img = Image.open(file).resize((224,224))\nimg_array = np.array(img)", goal: "Funci√≥n para limpiar EXIF y normalizar tama√±o para CLIP." },
            clip: { title: "OpenAI CLIP", role: "Ingeniero IA", desc: "Convierte im√°genes y texto en vectores matem√°ticos.", code: "inputs = processor(images=img, return_tensors='pt')\nembeds = model.get_image_features(**inputs)", goal: "Implementar extracci√≥n de embeddings usando HuggingFace Transformers." },
            whisper: { title: "OpenAI Whisper", role: "Ingeniero IA", desc: "Transcribe audio a texto con alta precisi√≥n.", code: "model = whisper.load_model('base')\nresult = model.transcribe('audio.mp3')", goal: "Script para transcribir audio optimizado para CPU." },
            ffmpeg: { title: "FFmpeg", role: "DevOps / Media", desc: "Herramienta de l√≠nea de comandos para manipular A/V.", code: "subprocess.run(['ffmpeg', '-i', input, output])", goal: "Wrapper de Python seguro para comandos FFmpeg." },
            python: { title: "Python 3.11", role: "Backend Dev", desc: "Lenguaje base del ecosistema.", code: "def main():\n    print('Hello minerOS')", goal: "Script base de Python con buenas pr√°cticas." },
            html: { title: "HTML5 Sem√°ntico", role: "Frontend Dev", desc: "Estructura de la interfaz.", code: "<article class='card'>\n  <h2>T√≠tulo</h2>\n</article>", goal: "Template HTML5 base con meta tags." },
            css: { title: "Tailwind CSS", role: "Frontend Dev", desc: "Estilos r√°pidos.", code: "<div class='p-4 bg-slate-900 text-white'>", goal: "Configurar CDN de Tailwind." },
            htmx: { title: "HTMX", role: "Frontend Dev", desc: "L√≥gica de interacci√≥n en HTML.", code: "<button hx-post='/api/action' hx-swap='outerHTML'>", goal: "Bot√≥n interactivo con HTMX." }
        };

        // ============================================
        // 2. ARQUITECTO PRO (CORE)
        // ============================================
        let canvasNodes = [];
        const toolbox = document.getElementById('architect-toolbox');
        const canvas = document.getElementById('architect-canvas');

        // Init Toolbox
        tools.forEach(t => {
            const el = document.createElement('div');
            const bc = catStyles[t.cat] || "border-slate-700";
            el.className = `draggable-tool bg-slate-800 border-l-4 ${bc} border-y border-r border-slate-700 p-3 rounded-r-lg flex items-center justify-between gap-3 hover:bg-slate-700 mb-2`;
            el.draggable = true;
            el.innerHTML = `<div class="flex items-center gap-3"><i class="fa-solid ${t.icon} ${t.color}"></i><div><span class="text-sm font-bold block">${t.name}</span><span class="text-[10px] text-slate-500 block">${t.tag}</span></div></div><i class="fa-solid fa-grip-vertical text-slate-600 text-xs"></i>`;
            el.ondragstart = (ev) => { ev.dataTransfer.setData("toolId", t.id); ev.dataTransfer.effectAllowed = "copy"; };
            toolbox.appendChild(el);
        });

        canvas.ondragover = (ev) => { ev.preventDefault(); ev.dataTransfer.dropEffect = "copy"; };
        canvas.ondrop = (ev) => { ev.preventDefault(); const toolId = ev.dataTransfer.getData("toolId"); if(toolId) addNodeToCanvas(toolId); };

        function addNodeToCanvas(toolId) { const tool = tools.find(t => t.id === toolId); if(tool) { canvasNodes.push(tool); renderCanvas(); } }
        function removeNode(index) { canvasNodes.splice(index, 1); renderCanvas(); }

        function renderCanvas() {
            canvas.innerHTML = '';
            if (canvasNodes.length === 0) {
                canvas.innerHTML = `<div id="canvas-placeholder" class="border-2 border-dashed border-slate-800 rounded-xl p-12 text-center text-slate-600 animate-in fade-in duration-300"><i class="fa-solid fa-hand-pointer text-2xl mb-2"></i><p>Arrastra herramientas aqu√≠</p></div>`;
                document.getElementById('node-count').textContent = '0';
                return;
            }
            canvasNodes.forEach((node, index) => {
                const bc = catStyles[node.cat] || "border-slate-600";
                const el = document.createElement('div');
                el.className = "flow-node relative group animate-in fade-in slide-in-from-bottom-2 duration-300";
                el.innerHTML = `
                    <div class="bg-slate-800 border border-slate-600 border-l-4 ${bc} p-4 rounded-xl flex items-center justify-between shadow-lg relative z-10">
                        <div class="flex items-center gap-4"><div class="w-8 h-8 rounded-full bg-slate-900 flex items-center justify-center border border-slate-700 font-mono text-xs text-slate-500">${index + 1}</div><div class="flex items-center gap-3"><i class="fa-solid ${node.icon} ${node.color} text-2xl"></i><div><h4 class="font-bold text-white text-lg leading-tight">${node.name}</h4><p class="text-[10px] text-slate-400 uppercase tracking-widest bg-slate-900/50 px-1 rounded inline-block mt-1">${node.tag}</p></div></div></div>
                        <button onclick="removeNode(${index})" class="text-slate-600 hover:text-red-400 transition p-2"><i class="fa-solid fa-trash"></i></button>
                    </div>
                    <div class="flow-arrow h-8 border-l-2 border-dashed border-slate-700 ml-8 relative"></div>`;
                canvas.appendChild(el);
            });
            document.getElementById('node-count').textContent = canvasNodes.length;
        }

        // --- FEATURES EXTRA ---
        function exportDiagram() {
            html2canvas(document.getElementById('architect-canvas'), { backgroundColor: "#0f172a" }).then(c => { const l = document.createElement('a'); l.download = 'arquitectura.png'; l.href = c.toDataURL(); l.click(); });
        }
        function saveArchitecture() {
            if(canvasNodes.length === 0) return alert("Nada que guardar.");
            const n = prompt("Nombre:", "Flujo " + new Date().toLocaleTimeString());
            if(n) { localStorage.setItem(`arch_${n}`, JSON.stringify(canvasNodes.map(n => n.id))); alert("Guardado."); }
        }
        function loadArchitectureModal() {
            const l = document.getElementById('load-list'); l.innerHTML = '';
            Object.keys(localStorage).filter(k => k.startsWith('arch_')).forEach(k => {
                const i = document.createElement('div');
                i.className = "p-2 hover:bg-slate-800 rounded cursor-pointer text-sm text-slate-300 flex justify-between";
                i.innerHTML = `<span>${k.replace('arch_','')}</span> <i class="fa-solid fa-chevron-right"></i>`;
                i.onclick = () => { 
                    try { canvasNodes = []; JSON.parse(localStorage.getItem(k)).forEach(id => { const t=tools.find(x=>x.id===id); if(t) canvasNodes.push(t); }); renderCanvas(); closeModal('load-modal'); } catch(e){} 
                };
                l.appendChild(i);
            });
            document.getElementById('load-modal').classList.remove('hidden');
        }
        function validateFlow() {
            const ids = canvasNodes.map(n => n.id);
            const errs = [];
            if (ids.includes('whisper') && !ids.includes('ffmpeg')) errs.push("‚ö†Ô∏è Whisper necesita FFmpeg.");
            if (ids.includes('clip') && !ids.includes('pillow') && !ids.includes('opencv')) errs.push("‚ö†Ô∏è CLIP necesita Pillow/OpenCV.");
            if (ids.length > 0 && !ids.some(id => ['chroma', 'sqlite'].includes(id))) errs.push("‚ö†Ô∏è Falta persistencia (DB).");
            alert(errs.length > 0 ? "Aviso:\n" + errs.join('\n') : "‚úÖ Flujo v√°lido.");
        }
        function estimateComplexity() { alert(`Complejidad estimada: ${canvasNodes.length * 2} puntos.`); }

        // --- PRESETS ---
        function initPresets() {
            const selector = document.getElementById('preset-selector');
            presets.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.id;
                opt.textContent = p.name;
                selector.appendChild(opt);
            });
        }

        function loadPreset(presetId) {
            if (!presetId) {
                document.getElementById('preset-info').classList.add('hidden');
                return;
            }

            const preset = presets.find(p => p.id === presetId);
            if (!preset) return;

            // Mostrar info del preset
            document.getElementById('preset-info').classList.remove('hidden');
            document.getElementById('preset-desc').textContent = preset.desc;
            document.getElementById('preset-flow').textContent = preset.flow;
            document.getElementById('preset-usecase').textContent = `Casos: ${preset.useCase}`;

            // Limpiar canvas y cargar herramientas del preset
            canvasNodes = [];
            preset.tools.forEach(toolId => {
                const tool = tools.find(t => t.id === toolId);
                if (tool) canvasNodes.push(tool);
            });
            renderCanvas();
        }

        // --- CORE UI ---
        function compileArchitecture() {
            if(canvasNodes.length===0) return alert("Lienzo vac√≠o");
            const stack = [...new Set(canvasNodes.map(n => n.name))].join(", ");
            const prompt = `**ROL:** Arquitecto Software.\n**OBJETIVO:** Pipeline datos.\n**FLUJO:**\n${canvasNodes.map((n, i) => `${i+1}. [${n.name}] (${n.tag})`).join('\n')}\n**STACK:** ${stack}\n**SALIDA:** Script Python modular.`;
            document.getElementById('architect-prompt-output').textContent = prompt;
            document.getElementById('architect-output-modal').classList.remove('hidden');
        }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function copyArchitectPrompt() { navigator.clipboard.writeText(document.getElementById('architect-prompt-output').textContent); }

        function switchView(view) {
            ['architect', 'generator', 'grid', 'flow', 'monitor'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                const b = document.getElementById(`btn-${v}`);
                if(b) { b.classList.replace('bg-blue-600', 'text-slate-400'); b.classList.replace('text-white', 'hover:bg-slate-800'); b.classList.remove('shadow-lg'); }
            });
            document.getElementById(`view-${view}`).classList.remove('hidden');
            const btn = document.getElementById(`btn-${view}`);
            if(btn) { btn.classList.replace('text-slate-400', 'bg-blue-600'); btn.classList.replace('hover:bg-slate-800', 'text-white'); btn.classList.add('shadow-lg'); }
            
            const headerTools = document.getElementById('header-tools');
            if(view === 'architect') headerTools.classList.remove('hidden'); else headerTools.classList.add('hidden');
            
            document.getElementById('page-title').textContent = { 'architect': 'Arquitecto Pro', 'generator': 'Generador', 'grid': 'Glosario', 'flow': 'Flujos', 'monitor': 'Monitor' }[view];
        }

        // Monitor & Generator
        let isOnline = false; const term = document.getElementById('terminal-window');
        function addLog(t,m){const time=new Date().toLocaleTimeString('es-ES',{hour12:false});let c="text-slate-300";if(t==="SUCCESS")c="text-green-400";if(t==="ERROR")c="text-red-400";term.innerHTML+=`<div class="terminal-line"><span class="text-slate-600">[${time}]</span> <span class="${c} font-bold w-16 inline-block">${t}</span> ${m}</div>`;term.scrollTop=term.scrollHeight;}
        setTimeout(()=>{addLog("INFO","Conectado a DirectOS v7.0 - Knowledge Base Edition")},1000);
        
        // Render Grid
        const grid = document.getElementById('tools-grid');
        tools.forEach(t => {
            const card = document.createElement('div');
            card.className = `bg-slate-900 border border-slate-800 border-l-4 ${catStyles[t.cat]} p-5 rounded-xl flex flex-col justify-between hover:border-slate-600 transition card-hover cursor-pointer`;
            card.onclick = () => openToolModal(t.id);
            card.innerHTML = `
                <div>
                    <div class="flex justify-between items-start mb-3">
                        <i class="fa-solid ${t.icon} ${t.color} text-xl"></i>
                        <span class="status-badge status-${t.status}">${statusLabels[t.status]}</span>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-1">${t.name}</h3>
                    <span class="text-[10px] bg-slate-950 px-2 py-0.5 rounded text-slate-500 uppercase tracking-wider">${t.tag}</span>
                    <p class="text-sm text-slate-400 mt-3 leading-relaxed">${t.desc}</p>
                </div>
                <div class="mt-4 pt-3 border-t border-slate-800 flex flex-wrap gap-1">
                    ${t.cases.slice(0, 2).map(c => `<span class="text-[10px] bg-slate-800 text-slate-400 px-2 py-1 rounded">${c}</span>`).join('')}
                    ${t.cases.length > 2 ? `<span class="text-[10px] text-slate-600">+${t.cases.length - 2}</span>` : ''}
                </div>`;
            grid.appendChild(card);
        });

        // Render Stack Selector
        const stackContainer = document.getElementById('stack-selector');
        const categories = {}; tools.forEach(t => { if(!categories[t.cat]) categories[t.cat] = []; categories[t.cat].push(t); });
        for (const [cat, items] of Object.entries(categories)) {
            const g = document.createElement('div'); g.className="mb-4"; g.innerHTML=`<h4 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2 sticky top-0 bg-slate-900 py-1">${cat}</h4>`;
            items.forEach(t=>{ const l=document.createElement('label'); l.className="flex items-center gap-3 p-2 rounded-lg cursor-pointer hover:bg-slate-800/50 transition group"; l.innerHTML=`<input type="checkbox" value="${t.name}" class="peer sr-only tool-checkbox"><div class="w-4 h-4 rounded border border-slate-600 bg-slate-900 peer-checked:bg-blue-500 flex items-center justify-center"><i class="fa-solid fa-check text-[10px] text-white opacity-0 check-icon"></i></div><span class="text-sm text-slate-300 peer-checked:text-white">${t.name}</span>`; g.appendChild(l); });
            stackContainer.appendChild(g);
        }

        // INTERACTIVIDAD COMPLETA
        function openNodeDetails(nodeId) {
            const data = nodeDetails[nodeId];
            if(!data) return;
            const modal = document.getElementById('node-modal');
            modal.classList.remove('hidden'); setTimeout(() => modal.classList.remove('translate-x-full'), 10);
            
            document.getElementById('modal-content').innerHTML = `
                <div class="mb-6"><span class="text-xs font-mono text-blue-400 border border-blue-500/30 px-2 py-1 rounded bg-blue-500/10 mb-2 inline-block">INSPECTOR</span><h2 class="text-2xl font-bold text-white">${data.title}</h2><p class="text-slate-400 mt-2 text-sm leading-relaxed">${data.desc}</p></div>
                <div class="mb-6"><h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">C√≥digo T√°ctico</h3><div class="bg-slate-950 border border-slate-800 rounded-lg p-3 font-mono text-xs text-green-400 overflow-x-auto"><pre>${data.code}</pre></div></div>
                <div class="mt-8 pt-6 border-t border-slate-800"><h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-3">Generar Prompt para...</h3><div class="grid grid-cols-1 gap-2">
                     <button onclick="jumpToGenerator('${nodeId}', 'scaffold')" class="w-full bg-slate-800 hover:bg-slate-700 text-slate-300 p-2 rounded-lg text-xs font-bold border border-slate-700 flex items-center gap-2">üèóÔ∏è Scaffold</button>
                     <button onclick="jumpToGenerator('${nodeId}', 'explain')" class="w-full bg-slate-800 hover:bg-slate-700 text-slate-300 p-2 rounded-lg text-xs font-bold border border-slate-700 flex items-center gap-2">üìñ Explicar</button>
                     <button onclick="jumpToGenerator('${nodeId}', 'optimize')" class="w-full bg-slate-800 hover:bg-blue-600 hover:text-white text-slate-300 p-2 rounded-lg text-xs font-bold border border-slate-700">üöÄ Optimizar</button>
                </div></div>`;
        }
        function closeNodeDetails() { const m = document.getElementById('node-modal'); m.classList.add('translate-x-full'); setTimeout(() => m.classList.add('hidden'), 300); }
        
        function jumpToGenerator(nodeId, mode) {
            const data = nodeDetails[nodeId]; closeNodeDetails(); switchView('generator');
            document.getElementById('prompt-role').value = data.role;
            let g = data.goal;
            if (mode === 'scaffold') g = `Generar el c√≥digo base (scaffold) para implementar ${data.title}.`;
            if (mode === 'explain') g = `Explicar l√≠nea por l√≠nea c√≥mo funciona ${data.title}.`;
            if (mode === 'optimize') g = `Analizar y optimizar el c√≥digo de ${data.title}.`;
            document.getElementById('prompt-goal').value = g;
        }

        // Helpers
        function setGoal(t) { document.getElementById('prompt-goal').value = t; }
        function clearSelection() { document.querySelectorAll('.tool-checkbox').forEach(c => c.checked = false); }
        function copyToClipboard() { navigator.clipboard.writeText(document.getElementById('prompt-output').textContent); }
        function generatePrompt() {
            const r = document.getElementById('prompt-role').value; const g = document.getElementById('prompt-goal').value || "[Objetivo]"; const s = Array.from(document.querySelectorAll('.tool-checkbox:checked')).map(cb => cb.value).join(", ") || "stack";
            document.getElementById('prompt-output').textContent = `**ROL:** ${r}\n**STACK:** ${s}\n**OBJETIVO:** ${g}\n**ESTILO:** Local-first.`;
        }
        function loadProjectPreset() { const v=document.getElementById('project-select').value; canvasNodes=[]; if(v==='videomine')['fastapi','ffmpeg','whisper','clip','chroma'].forEach(id=>addNodeToCanvas(id)); else if(v==='docmine')['fastapi','python','clip','chroma','sqlite'].forEach(id=>addNodeToCanvas(id)); renderCanvas(); }

        setInterval(() => { document.getElementById('clock').textContent = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }, 1000);
        initPresets(); // Cargar patrones de arquitectura
        initPatternsAccordion(); // Cargar biblioteca de patrones
        switchView('architect'); renderCanvas();

        // ============================================
        // BIBLIOTECA DE PATRONES - FUNCIONES
        // ============================================
        let currentPattern = null;

        function initPatternsAccordion() {
            const container = document.getElementById('patterns-accordion');
            if (!container) return;

            container.innerHTML = '';

            for (const [catId, category] of Object.entries(promptPatterns)) {
                const catDiv = document.createElement('div');
                catDiv.className = 'border border-slate-800 rounded-lg overflow-hidden';

                // Header del acorde√≥n
                const header = document.createElement('button');
                header.className = 'w-full flex items-center justify-between p-3 bg-slate-950 hover:bg-slate-800 transition text-left';
                header.innerHTML = `
                    <div class="flex items-center gap-2">
                        <i class="fa-solid ${category.icon} text-slate-500 text-xs"></i>
                        <span class="text-sm font-medium text-slate-300">${category.name}</span>
                        <span class="text-[10px] bg-slate-800 text-slate-500 px-1.5 py-0.5 rounded">${category.patterns.length}</span>
                    </div>
                    <i class="fa-solid fa-chevron-down text-slate-600 text-xs transition-transform accordion-icon"></i>
                `;

                // Contenido del acorde√≥n
                const content = document.createElement('div');
                content.className = 'hidden bg-slate-900/50 border-t border-slate-800';

                category.patterns.forEach(pattern => {
                    const patternBtn = document.createElement('button');
                    patternBtn.className = 'w-full text-left p-2.5 hover:bg-slate-800 transition flex items-center gap-2 border-b border-slate-800/50 last:border-0';
                    patternBtn.innerHTML = `
                        <span class="text-base">${pattern.emoji}</span>
                        <span class="text-xs text-slate-400">${pattern.name}</span>
                    `;
                    patternBtn.onclick = () => openPatternModal(pattern);
                    content.appendChild(patternBtn);
                });

                // Toggle acorde√≥n
                header.onclick = () => {
                    const isOpen = !content.classList.contains('hidden');
                    // Cerrar todos
                    container.querySelectorAll('.accordion-content').forEach(c => c.classList.add('hidden'));
                    container.querySelectorAll('.accordion-icon').forEach(i => i.style.transform = 'rotate(0deg)');
                    // Abrir actual si estaba cerrado
                    if (!isOpen) {
                        content.classList.remove('hidden');
                        header.querySelector('.accordion-icon').style.transform = 'rotate(180deg)';
                    }
                };

                content.classList.add('accordion-content');
                catDiv.appendChild(header);
                catDiv.appendChild(content);
                container.appendChild(catDiv);
            }
        }

        function openPatternModal(pattern) {
            currentPattern = pattern;

            document.getElementById('pattern-modal-emoji').textContent = pattern.emoji;
            document.getElementById('pattern-modal-title').textContent = pattern.name;
            document.getElementById('pattern-modal-problem').textContent = pattern.problem;
            document.getElementById('pattern-modal-prompt').textContent = pattern.prompt;
            document.getElementById('pattern-modal-flowdesc').textContent = pattern.flowDesc;

            // Renderizar herramientas del flujo
            const flowContainer = document.getElementById('pattern-modal-flow');
            flowContainer.innerHTML = pattern.flow.map(toolId => {
                const tool = tools.find(t => t.id === toolId);
                if (!tool) return '';
                return `<span class="inline-flex items-center gap-1.5 bg-slate-800 border border-slate-700 px-2 py-1 rounded text-xs">
                    <i class="fa-solid ${tool.icon} ${tool.color}"></i>
                    <span class="text-slate-300">${tool.name}</span>
                </span>`;
            }).join('<span class="text-slate-600">‚Üí</span>');

            document.getElementById('pattern-modal').classList.remove('hidden');
        }

        function loadPatternToPrompt() {
            if (!currentPattern) return;

            // Copiar prompt al output
            document.getElementById('prompt-output').textContent = currentPattern.prompt;

            // Seleccionar herramientas del stack
            document.querySelectorAll('.tool-checkbox').forEach(cb => {
                const toolName = cb.value;
                const tool = tools.find(t => t.name === toolName);
                cb.checked = tool && currentPattern.flow.includes(tool.id);
            });

            closeModal('pattern-modal');

            // Notificaci√≥n
            addLog("SUCCESS", `Patr√≥n "${currentPattern.name}" cargado en Generador`);
        }

        function loadPatternToArchitect() {
            if (!currentPattern) return;

            // Limpiar canvas y cargar herramientas del patr√≥n
            canvasNodes = [];
            currentPattern.flow.forEach(toolId => {
                const tool = tools.find(t => t.id === toolId);
                if (tool) canvasNodes.push(tool);
            });
            renderCanvas();

            closeModal('pattern-modal');
            switchView('architect');

            // Notificaci√≥n
            addLog("SUCCESS", `Patr√≥n "${currentPattern.name}" cargado en Arquitecto Pro`);
        }

        // ============================================
        // FICHA T√âCNICA - FUNCIONES
        // ============================================
        let currentTool = null;

        function openToolModal(toolId) {
            const tool = tools.find(t => t.id === toolId);
            if (!tool) return;
            currentTool = tool;

            // Rellenar datos
            const iconEl = document.getElementById('tool-modal-icon');
            iconEl.className = `fa-solid ${tool.icon} ${tool.color} text-2xl`;
            document.getElementById('tool-modal-title').textContent = tool.name;
            document.getElementById('tool-modal-tag').textContent = `${tool.cat} ‚Ä¢ ${tool.tag}`;

            const statusEl = document.getElementById('tool-modal-status');
            statusEl.textContent = statusLabels[tool.status];
            statusEl.className = `status-badge status-${tool.status}`;

            document.getElementById('tool-modal-desc').textContent = tool.desc;
            document.getElementById('tool-modal-why').textContent = tool.why;
            document.getElementById('tool-modal-code').textContent = tool.code;

            // Renderizar casos de uso
            const casesContainer = document.getElementById('tool-modal-cases');
            casesContainer.innerHTML = tool.cases.map(c =>
                `<span class="bg-slate-800 border border-slate-700 text-slate-300 text-xs px-3 py-1.5 rounded-lg">${c}</span>`
            ).join('');

            document.getElementById('tool-modal').classList.remove('hidden');
        }

        function addToolToArchitect() {
            if (!currentTool) return;
            addNodeToCanvas(currentTool.id);
            closeModal('tool-modal');
            switchView('architect');
            addLog("SUCCESS", `"${currentTool.name}" a√±adido al Arquitecto`);
        }

        function copyToolCode() {
            if (!currentTool) return;
            navigator.clipboard.writeText(currentTool.code);
            addLog("SUCCESS", `C√≥digo de "${currentTool.name}" copiado`);
        }

        // ============================================
        // 6. BACKEND API CONNECTION
        // ============================================
        const API_URL = 'http://localhost:8000';

        // Health Check
        async function checkHealth() {
            try {
                const start = Date.now();
                const res = await fetch(`${API_URL}/api/health`);
                const latency = Date.now() - start;
                const data = await res.json();

                document.getElementById('health-metric').textContent = latency;
                document.getElementById('health-msg').textContent = `Online - v${data.version}`;
                document.getElementById('health-bar').style.width = Math.min(100, 100 - latency/5) + '%';
                document.getElementById('term-dot').classList.add('bg-green-500');
                document.getElementById('term-dot').classList.remove('bg-red-500/20');
                addLog("SUCCESS", `Backend conectado (${latency}ms)`);

                // Mostrar estado de m√≥dulos
                if (data.modules) {
                    addLog("INFO", `Knowledge: ${data.modules.knowledge ? '‚úì' : '‚úó'} | Scout: ${data.modules.scout ? '‚úì' : '‚úó'}`);
                }
            } catch (e) {
                document.getElementById('health-metric').textContent = '--';
                document.getElementById('health-msg').textContent = 'Backend offline';
                document.getElementById('health-bar').style.width = '0%';
                addLog("ERROR", "No se pudo conectar al backend. Ejecuta: ./start.sh");
            }
        }

        // Knowledge Base - B√∫squeda Sem√°ntica
        async function searchKnowledgeBase() {
            const query = document.getElementById('kb-search').value.trim();
            if (!query) return;

            const resultsDiv = document.getElementById('kb-results');
            resultsDiv.innerHTML = '<p class="text-slate-500 text-sm">Buscando...</p>';
            resultsDiv.classList.remove('hidden');

            try {
                const res = await fetch(`${API_URL}/api/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query, limit: 5 })
                });
                const results = await res.json();

                if (results.length === 0) {
                    resultsDiv.innerHTML = '<p class="text-slate-500 text-sm">No se encontraron resultados. ¬øHas indexado tus archivos?</p>';
                    return;
                }

                resultsDiv.innerHTML = results.map(r => `
                    <div class="bg-slate-950 border border-slate-800 rounded-lg p-3">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] text-slate-500 font-mono">${r.source.split('/').pop()}</span>
                            <span class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded">${Math.round(r.score * 100)}% match</span>
                        </div>
                        <p class="text-sm text-slate-300 leading-relaxed">${r.text.substring(0, 300)}${r.text.length > 300 ? '...' : ''}</p>
                    </div>
                `).join('');
                addLog("SUCCESS", `B√∫squeda: "${query}" ‚Üí ${results.length} resultados`);
            } catch (e) {
                resultsDiv.innerHTML = '<p class="text-red-400 text-sm">Error: Backend no disponible</p>';
                addLog("ERROR", "Knowledge Base no disponible");
            }
        }

        // Knowledge Base - Indexar
        async function indexKnowledgeBase() {
            addLog("INFO", "Indexando archivos markdown del Desktop...");
            try {
                const res = await fetch(`${API_URL}/api/index`, { method: 'POST' });
                const data = await res.json();
                addLog("SUCCESS", `Indexados ${data.indexed} chunks de ${data.path}`);
                alert(`Indexaci√≥n completada: ${data.indexed} fragmentos`);
            } catch (e) {
                addLog("ERROR", "Error al indexar");
            }
        }

        // Scout - Analizar Error
        async function analyzeWithScout() {
            const errorText = document.getElementById('scout-input').value.trim();
            if (!errorText) return alert("Pega un error para analizar");

            const btn = document.getElementById('scout-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Analizando...';
            addLog("INFO", "Scout analizando error...");

            try {
                const res = await fetch(`${API_URL}/api/scout/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ error_text: errorText, context: "DirectOS / minerOS stack" })
                });
                const data = await res.json();

                // Mostrar resultado en terminal
                addLog("SUCCESS", "Scout encontr√≥ una soluci√≥n:");
                term.innerHTML += `<div class="terminal-line mt-2 p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg"><pre class="text-purple-300 whitespace-pre-wrap">${data.analysis}</pre></div>`;
                term.scrollTop = term.scrollHeight;

            } catch (e) {
                addLog("ERROR", "Scout no disponible. ¬øConfiguraste ANTHROPIC_API_KEY?");
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-magnifying-glass-chart"></i> Analizar Error';
            }
        }

        // Enter para buscar
        document.getElementById('kb-search')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchKnowledgeBase();
        });

        // Check health on load
        setTimeout(checkHealth, 1500);
        setInterval(checkHealth, 30000); // cada 30s
    </script>
</body>
</html>